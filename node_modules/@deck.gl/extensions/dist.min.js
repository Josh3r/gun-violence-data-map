!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("deck"),require("luma")):"function"==typeof define&&define.amd?define(["deck","luma"],n):"object"==typeof exports?exports.deck=n(require("deck"),require("luma")):e.deck=n(e.deck,e.luma)}(window,(function(e,n){return function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(o,i,function(n){return e[n]}.bind(null,i));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=7)}([function(n,t){n.exports=e},function(e,n){e.exports=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}},function(e,n){function t(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}},function(e,n,t){var o=t(8),i=t(9);e.exports=function(e,n){return!n||"object"!==o(n)&&"function"!=typeof n?i(e):n}},function(e,n){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t},function(e,n,t){var o=t(10);e.exports=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&o(e,n)}},function(e,t){e.exports=n},function(e,n,t){var o=t(11),i=("undefined"==typeof window?global:window).deck||{};if(!i.Layer)throw new Error("@deck.gl/core is not found");e.exports=Object.assign(i,o)},function(e,n){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(n){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?e.exports=o=function(e){return t(e)}:e.exports=o=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},o(n)}e.exports=o},function(e,n){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,n){function t(n,o){return e.exports=t=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e},t(n,o)}e.exports=t},function(e,n,t){"use strict";t.r(n);var o=t(1),i=t.n(o),r=t(2),s=t.n(r),a=t(3),u=t.n(a),f=t(4),l=t.n(f),c=t(5),p=t.n(c),_=t(0),v={source:0,target:1,custom:2},d={name:"brushing",dependencies:[_.project],vs:"\n  uniform bool brushing_enabled;\n  uniform int brushing_target;\n  uniform vec2 brushing_mousePos;\n  uniform float brushing_radius;\n\n  #ifdef NON_INSTANCED_MODEL\n  attribute vec2 brushingTargets;\n  #else\n  attribute vec2 instanceBrushingTargets;\n  #endif\n\n  varying float brushing_isVisible;\n\n  bool brushing_isPointInRange(vec2 position) {\n    if (!brushing_enabled) {\n      return true;\n    }\n    vec2 source_commonspace = project_position(position);\n    vec2 target_commonspace = project_position(brushing_mousePos);\n    float distance = length((target_commonspace - source_commonspace) / project_uCommonUnitsPerMeter.xy);\n\n    return distance <= brushing_radius;\n  }\n\n  void brushing_setVisible(bool visible) {\n    brushing_isVisible = float(visible);\n  }\n",fs:"\n  uniform bool brushing_enabled;\n  varying float brushing_isVisible;\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    vec2 brushingTarget;\n    if (brushing_target == 0) {\n      brushingTarget = geometry.worldPosition.xy;\n    } else if (brushing_target == 1) {\n      brushingTarget = geometry.worldPositionAlt.xy;\n    } else {\n      #ifdef NON_INSTANCED_MODEL\n      brushingTarget = brushingTargets;\n      #else\n      brushingTarget = instanceBrushingTargets;\n      #endif\n    }\n    brushing_setVisible(brushing_isPointInRange(brushingTarget));\n  ","fs:DECKGL_FILTER_COLOR":"\n    if (brushing_enabled && brushing_isVisible < 0.5) {\n      discard;\n    }\n  "},getUniforms:function(e){if(!e||!e.viewport)return{};var n=e.brushingEnabled,t=void 0===n||n,o=e.brushingRadius,i=void 0===o?1e4:o,r=e.brushingTarget,s=void 0===r?"source":r,a=e.mousePosition,u=e.viewport;return{brushing_enabled:Boolean(t&&a&&u.containsPixel(a)),brushing_radius:i,brushing_target:v[s]||0,brushing_mousePos:a?u.unproject([a.x-u.x,a.y-u.y]):[0,0]}}},g=function(e){function n(){return i()(this,n),u()(this,l()(n).apply(this,arguments))}return p()(n,e),s()(n,[{key:"getShaders",value:function(e){return{modules:[d]}}},{key:"initializeState",value:function(e,n){var t=this,o=this.getAttributeManager();o&&o.add({brushingTargets:{size:2,accessor:"getBrushingTarget",update:!this.props.getBrushingTarget&&n.useConstantTargetPositions,shaderAttributes:{brushingTargets:{divisor:0},instanceBrushingTargets:{divisor:1}}}}),n.onMouseMove=function(){t.getCurrentLayer().setNeedsRedraw()},this.context.deck&&this.context.deck.eventManager.on({pointermove:n.onMouseMove,pointerleave:n.onMouseMove})}},{key:"finalizeState",value:function(e){this.context.deck&&this.context.deck.eventManager.off({pointermove:e.onMouseMove,pointerleave:e.onMouseMove})}},{key:"useConstantTargetPositions",value:function(e){e.constant=!0,e.value=new Float32Array(2)}}]),n}(_.LayerExtension);g.extensionName="BrushingExtension",g.defaultProps={getBrushingTarget:{type:"accessor",value:[0,0]},brushingTarget:"source",brushingEnabled:!0,brushingRadius:1e4};var m={name:"data-filter",vs:"\nuniform DATAFILTER_TYPE filter_min;\nuniform DATAFILTER_TYPE filter_softMin;\nuniform DATAFILTER_TYPE filter_softMax;\nuniform DATAFILTER_TYPE filter_max;\nuniform bool filter_useSoftMargin;\nuniform bool filter_enabled;\nuniform bool filter_transformSize;\n\n#ifdef NON_INSTANCED_MODEL\nattribute DATAFILTER_TYPE filterValues;\n#else\nattribute DATAFILTER_TYPE instanceFilterValues;\n#endif\n\nvarying float dataFilter_value;\n\nfloat dataFilter_reduceValue(float value) {\n  return value;\n}\nfloat dataFilter_reduceValue(vec2 value) {\n  return min(value.x, value.y);\n}\nfloat dataFilter_reduceValue(vec3 value) {\n  return min(min(value.x, value.y), value.z);\n}\nfloat dataFilter_reduceValue(vec4 value) {\n  return min(min(value.x, value.y), min(value.z, value.w));\n}\nvoid dataFilter_setValue(DATAFILTER_TYPE value) {\n  if (filter_enabled) {\n    if (filter_useSoftMargin) {\n      dataFilter_value = dataFilter_reduceValue(\n        smoothstep(filter_min, filter_softMin, value) *\n        (1.0 - smoothstep(filter_softMax, filter_max, value))\n      );\n    } else {\n      dataFilter_value = dataFilter_reduceValue(\n        step(filter_min, value) * step(value, filter_max)\n      );\n    }\n  } else {\n    dataFilter_value = 1.0;\n  }\n}\n",fs:"\nuniform bool filter_transformColor;\nvarying float dataFilter_value;\n",inject:{"vs:#main-start":"\n    #ifdef NON_INSTANCED_MODEL\n    dataFilter_setValue(filterValues);\n    #else\n    dataFilter_setValue(instanceFilterValues);\n    #endif\n  ","vs:DECKGL_FILTER_SIZE":"\n    if (filter_transformSize) {\n      size = size * dataFilter_value;\n    }\n  ","fs:DECKGL_FILTER_COLOR":"\n    if (dataFilter_value == 0.0) discard;\n    if (filter_transformColor) {\n      color.a *= dataFilter_value;\n    }\n  "},getUniforms:function(e){if(!e||!e.extensions)return{};var n=e.filterRange,t=void 0===n?[-1,1]:n,o=e.filterEnabled,i=void 0===o||o,r=e.filterTransformSize,s=void 0===r||r,a=e.filterTransformColor,u=void 0===a||a,f=e.filterSoftRange||t,l=Number.isFinite(t[0])?{filter_min:t[0],filter_softMin:f[0],filter_softMax:f[1],filter_max:t[1]}:{filter_min:t.map((function(e){return e[0]})),filter_softMin:f.map((function(e){return e[0]})),filter_softMax:f.map((function(e){return e[1]})),filter_max:t.map((function(e){return e[1]}))};return l.filter_enabled=i,l.filter_useSoftMargin=Boolean(e.filterSoftRange),l.filter_transformSize=i&&s,l.filter_transformColor=i&&u,l}},h={1:"float",2:"vec2",3:"vec3",4:"vec4"},b=function(e){function n(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).filterSize,t=void 0===e?1:e;if(i()(this,n),!h[t])throw new Error("filterSize out of range");return u()(this,l()(n).call(this,{filterSize:t}))}return p()(n,e),s()(n,[{key:"getShaders",value:function(e){var n=e.opts.filterSize;return{modules:[m],defines:{DATAFILTER_TYPE:h[n]}}}},{key:"initializeState",value:function(e,n){var t=this.getAttributeManager();t&&t.add({filterValues:{size:n.opts.filterSize,accessor:"getFilterValue",shaderAttributes:{filterValues:{divisor:0},instanceFilterValues:{divisor:1}}}})}}]),n}(_.LayerExtension);b.extensionName="DataFilterExtension",b.defaultProps={getFilterValue:{type:"accessor",value:0},filterEnabled:!0,filterRange:[-1,1],filterSoftRange:null,filterTransformSize:!0,filterTransformColor:!0};var y=t(6),x=y.fp64.fp64ify,P=y.fp64.fp64ifyMatrix4,T={name:"project64",dependencies:[_.project,y.fp64],vs:"\nconst vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);\n\nuniform vec2 project_uViewProjectionMatrixFP64[16];\nvoid mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {\n\n#if defined(NVIDIA_FP64_WORKAROUND)\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);\n#else\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);\n#endif\n  out_val[1] = sum_fp64(PI_FP64,\n    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));\n  return;\n}\n\nvoid project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {\n  vec2 pos_fp64[2];\n  mercatorProject_fp64(position_fp64, pos_fp64);\n  out_val[0] = mul_fp64(pos_fp64[0], WORLD_SCALE_FP64);\n  out_val[1] = mul_fp64(pos_fp64[1], WORLD_SCALE_FP64);\n\n  return;\n}\n\nvoid project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {\n  vec4 position64xy = vec4(\n    position.x, position64xyLow.x,\n    position.y, position64xyLow.y);\n\n  project_position_fp64(position64xy, out_val);\n}\n\nvec4 project_common_position_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  vec2 vertex_pos_clipspace[4];\n  mat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,\n    vertex_pos_clipspace);\n  return vec4(\n    vertex_pos_clipspace[0].x,\n    vertex_pos_clipspace[1].x,\n    vertex_pos_clipspace[2].x,\n    vertex_pos_clipspace[3].x\n    );\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\n  vec2 offset64[4];\n  vec4_fp64(vec4(offset, 0.0), offset64);\n\n  float z = project_size(position.z);\n  vec2 projectedPosition64xy[2];\n  project_position_fp64(position.xy, position64xyLow.xy, projectedPosition64xy);\n\n  vec2 commonPosition64[4];\n  commonPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);\n  commonPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);\n  commonPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));\n  commonPosition64[3] = vec2(1.0, 0.0);\n\n  commonPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);\n\n  return project_common_position_to_clipspace_fp64(commonPosition64);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64xyLow, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(\n    position, position64xyLow, offset, commonPosition\n  );\n}\n",getUniforms:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;if(e.viewport){var n=e.viewport,t=n.viewProjectionMatrix,o=n.scale;return L({viewProjectionMatrix:t,scale:o})}return{}}},E={},L=Object(_._memoize)((function(e){var n=e.viewProjectionMatrix,t=e.scale,o=P(n),i=x(t);return{project_uViewProjectionMatrixFP64:o,project64_uViewProjectionMatrix:o,project64_uScale:i}}));var j=function(e){function n(){return i()(this,n),u()(this,l()(n).apply(this,arguments))}return p()(n,e),s()(n,[{key:"getShaders",value:function(e){var n=this.props.coordinateSystem;if(n!==_.COORDINATE_SYSTEM.LNGLAT&&n!==_.COORDINATE_SYSTEM.DEFAULT)throw new Error("fp64: coordinateSystem must be LNGLAT");return{modules:[T]}}}]),n}(_.LayerExtension);j.extensionName="Fp64Extension";var S={inject:{"vs:#decl":"\nattribute vec2 instanceDashArrays;\nvarying vec2 vDashArray;\n","vs:#main-end":"\nvDashArray = instanceDashArrays;\n","fs:#decl":"\nuniform float dashAlignMode;\nvarying vec2 vDashArray;\nfloat mod2(float a, float b) {\n  return a - floor(a / b) * b;\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\n","fs:#main-start":"\n  float solidLength = vDashArray.x;\n  float gapLength = vDashArray.y;\n  float unitLength = solidLength + gapLength;\n\n  if (unitLength > 0.0) {\n    unitLength = mix(\n      unitLength,\n      vPathLength / round(vPathLength / unitLength),\n      dashAlignMode\n    );\n\n    float offset = dashAlignMode * solidLength / 2.0;\n\n    if (\n      gapLength > 0.0 &&\n      vPathPosition.y >= 0.0 &&\n      vPathPosition.y <= vPathLength &&\n      mod2(vPathPosition.y + offset, unitLength) > solidLength\n    ) {\n      discard;\n    }\n  }  \n"}},F=function(e){function n(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).dash,t=void 0!==e&&e;return i()(this,n),u()(this,l()(n).call(this,{dash:t}))}return p()(n,e),s()(n,[{key:"isEnabled",value:function(e){return e.state.pathTesselator}},{key:"getShaders",value:function(e){if(!e.isEnabled(this))return null;var n={};return e.opts.dash&&(n=Object(_._mergeShaders)(n,S)),n}},{key:"initializeState",value:function(e,n){var t=this.getAttributeManager();t&&n.isEnabled(this)&&(n.enabled=!0,n.opts.dash&&t.add({instanceDashArrays:{size:2,accessor:"getDashArray"}}))}},{key:"updateState",value:function(e,n){if(n.isEnabled(this)){var t={};n.opts.dash&&(t.dashAlignMode=this.props.dashJustified?1:0),this.state.model.setUniforms(t)}}}]),n}(_.LayerExtension);F.extensionName="PathStyleExtension",F.defaultProps={getDashArray:{type:"accessor",value:[0,0]},dashJustified:!1},t.d(n,"BrushingExtension",(function(){return g})),t.d(n,"DataFilterExtension",(function(){return b})),t.d(n,"Fp64Extension",(function(){return j})),t.d(n,"PathStyleExtension",(function(){return F})),t.d(n,"project64",(function(){return T}))}])}));