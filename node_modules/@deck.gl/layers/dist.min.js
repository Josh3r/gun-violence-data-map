!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("deck"),require("luma")):"function"==typeof define&&define.amd?define(["deck","luma"],t):"object"==typeof exports?exports.deck=t(require("deck"),require("luma")):e.deck=t(e.deck,e.luma)}(window,(function(e,t){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(t,n){t.exports=e},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,n){e.exports=t},function(e,t,n){e.exports=n(18)},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){var i=n(16);function r(t,n,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=r=Reflect.get:e.exports=r=function(e,t,n){var r=i(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},r(t,n,o||t)}e.exports=r},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.exports=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}},function(e,t,n){var i=n(14),r=n(15);e.exports=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?r(e):t}},function(e,t,n){var i=n(17);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){var i=n(19),r=n(20),o=n(21);e.exports=function(e,t){return i(e)||r(e,t)||o()}},function(e,t,n){"use strict";function i(e,t,n){n=n||2;var i,s,l,c,u,d,h,v=t&&t.length,y=v?t[0]*n:e.length,m=r(e,0,y,n,!0),x=[];if(!m||m.next===m.prev)return x;if(v&&(m=function(e,t,n,i){var a,s,l,c,u,d=[];for(a=0,s=t.length;a<s;a++)l=t[a]*i,c=a<s-1?t[a+1]*i:e.length,(u=r(e,l,c,i,!1))===u.next&&(u.steiner=!0),d.push(g(u));for(d.sort(f),a=0;a<d.length;a++)p(d[a],n),n=o(n,n.next);return n}(e,t,m,n)),e.length>80*n){i=l=e[0],s=c=e[1];for(var P=n;P<y;P+=n)(u=e[P])<i&&(i=u),(d=e[P+1])<s&&(s=d),u>l&&(l=u),d>c&&(c=d);h=0!==(h=Math.max(l-i,c-s))?1/h:0}return a(m,x,n,i,s,h),x}function r(e,t,n,i,r){var o,a;if(r===C(e,t,n,i)>0)for(o=t;o<n;o+=i)a=w(o,e[o],e[o+1],a);else for(o=n-i;o>=t;o-=i)a=w(o,e[o],e[o+1],a);return a&&m(a,a.next)&&(_(a),a=a.next),a}function o(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!m(i,i.next)&&0!==y(i.prev,i,i.next))i=i.next;else{if(_(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function a(e,t,n,i,r,f,p){if(e){!p&&f&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=d(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,a,s,l,c=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,i=n,s=0,t=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(a>1)}(r)}(e,i,r,f);for(var g,h,v=e;e.prev!==e.next;)if(g=e.prev,h=e.next,f?l(e,i,r,f):s(e))t.push(g.i/n),t.push(e.i/n),t.push(h.i/n),_(e),e=h.next,v=h.next;else if((e=h)===v){p?1===p?a(e=c(e,t,n),t,n,i,r,f,2):2===p&&u(e,t,n,i,r,f):a(o(e),t,n,i,r,f,1);break}}}function s(e){var t=e.prev,n=e,i=e.next;if(y(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(h(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&y(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(e,t,n,i){var r=e.prev,o=e,a=e.next;if(y(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,c=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,u=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,f=d(s,l,t,n,i),p=d(c,u,t,n,i),g=e.prevZ,v=e.nextZ;g&&g.z>=f&&v&&v.z<=p;){if(g!==e.prev&&g!==e.next&&h(r.x,r.y,o.x,o.y,a.x,a.y,g.x,g.y)&&y(g.prev,g,g.next)>=0)return!1;if(g=g.prevZ,v!==e.prev&&v!==e.next&&h(r.x,r.y,o.x,o.y,a.x,a.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;g&&g.z>=f;){if(g!==e.prev&&g!==e.next&&h(r.x,r.y,o.x,o.y,a.x,a.y,g.x,g.y)&&y(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;v&&v.z<=p;){if(v!==e.prev&&v!==e.next&&h(r.x,r.y,o.x,o.y,a.x,a.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function c(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!m(r,o)&&x(r,i,i.next,o)&&P(r,o)&&P(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),_(i),_(i.next),i=e=o),i=i.next}while(i!==e);return i}function u(e,t,n,i,r,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&v(l,c)){var u=b(l,c);return l=o(l,l.next),u=o(u,u.next),a(l,t,n,i,r,s),void a(u,t,n,i,r,s)}c=c.next}l=l.next}while(l!==e)}function f(e,t){return e.x-t.x}function p(e,t){if(t=function(e,t){var n,i=t,r=e.x,o=e.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){if(a=s,s===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===a)return n.prev;var l,c=n,u=n.x,f=n.y,p=1/0;i=n.next;for(;i!==c;)r>=i.x&&i.x>=u&&r!==i.x&&h(o<f?r:a,o,u,f,o<f?a:r,o,i.x,i.y)&&((l=Math.abs(o-i.y)/(r-i.x))<p||l===p&&i.x>n.x)&&P(i,e)&&(n=i,p=l),i=i.next;return n}(e,t)){var n=b(t,e);o(n,n.next)}}function d(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function h(e,t,n,i,r,o,a,s){return(r-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(i-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&x(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&P(e,t)&&P(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)}function y(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,n,i){return!!(m(e,t)&&m(n,i)||m(e,i)&&m(n,t))||y(e,t,n)>0!=y(e,t,i)>0&&y(n,i,e)>0!=y(n,i,t)>0}function P(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function b(e,t){var n=new S(e.i,e.x,e.y),i=new S(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function w(e,t,n,i){var r=new S(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function _(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,n,i){for(var r=0,o=t,a=n-i;o<n;o+=i)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}e.exports=i,e.exports.default=i,i.deviation=function(e,t,n,i){var r=t&&t.length,o=r?t[0]*n:e.length,a=Math.abs(C(e,0,o,n));if(r)for(var s=0,l=t.length;s<l;s++){var c=t[s]*n,u=s<l-1?t[s+1]*n:e.length;a-=Math.abs(C(e,c,u,n))}var f=0;for(s=0;s<i.length;s+=3){var p=i[s]*n,d=i[s+1]*n,g=i[s+2]*n;f+=Math.abs((e[p]-e[g])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[g+1]-e[p+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},i.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[r][o][a]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n}},function(e,t,n){"use strict";e.exports=r,e.exports.default=r;var i=1e20;function r(e,t,n,i,r,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function o(e,t,n,i,r,o,s){for(var l=0;l<t;l++){for(var c=0;c<n;c++)i[c]=e[c*t+l];for(a(i,r,o,s,n),c=0;c<n;c++)e[c*t+l]=r[c]}for(c=0;c<n;c++){for(l=0;l<t;l++)i[l]=e[c*t+l];for(a(i,r,o,s,t),l=0;l<t;l++)e[c*t+l]=Math.sqrt(r[l])}}function a(e,t,n,r,o){n[0]=0,r[0]=-i,r[1]=+i;for(var a=1,s=0;a<o;a++){for(var l=(e[a]+a*a-(e[n[s]]+n[s]*n[s]))/(2*a-2*n[s]);l<=r[s];)s--,l=(e[a]+a*a-(e[n[s]]+n[s]*n[s]))/(2*a-2*n[s]);n[++s]=a,r[s]=l,r[s+1]=+i}for(a=0,s=0;a<o;a++){for(;r[s+1]<a;)s++;t[a]=(a-n[s])*(a-n[s])+e[n[s]]}}r.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var a=t.data[4*r+3]/255;this.gridOuter[r]=1===a?0:0===a?i:Math.pow(Math.max(0,.5-a),2),this.gridInner[r]=1===a?i:0===a?0:Math.pow(Math.max(0,a-.5),2)}for(o(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),o(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++){var s=this.gridOuter[r]-this.gridInner[r];n[r]=Math.max(0,Math.min(255,Math.round(255-255*(s/this.radius+this.cutoff))))}return n}},function(e,t,n){var i=n(22),r=("undefined"==typeof window?global:window).deck||{};if(!r.Layer)throw new Error("@deck.gl/core is not found");e.exports=Object.assign(r,i)},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=i=function(e){return n(e)}:e.exports=i=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},i(t)}e.exports=i},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var i=n(1);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}},function(e,t){function n(t,i){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,i)}e.exports=n},function(e,t,n){var i=function(e){"use strict";var t,n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function l(e,t,n,i){var r=t&&t.prototype instanceof h?t:h,o=Object.create(r.prototype),a=new O(i||[]);return o._invoke=function(e,t,n){var i=u;return function(r,o){if(i===p)throw new Error("Generator is already running");if(i===d){if("throw"===r)throw o;return M()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=S(a,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===u)throw i=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=c(e,t,n);if("normal"===l.type){if(i=n.done?d:f,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=d,n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u="suspendedStart",f="suspendedYield",p="executing",d="completed",g={};function h(){}function v(){}function y(){}var m={};m[o]=function(){return this};var x=Object.getPrototypeOf,P=x&&x(x(A([])));P&&P!==n&&i.call(P,o)&&(m=P);var b=y.prototype=h.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function _(e){var t;this._invoke=function(n,r){function o(){return new Promise((function(t,o){!function t(n,r,o,a){var s=c(e[n],e,r);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(u).then((function(e){l.value=e,o(l)}),(function(e){return t("throw",e,o,a)}))}a(s.arg)}(n,r,t,o)}))}return t=t?t.then(o,o):o()}}function S(e,n){var i=e.iterator[n.method];if(i===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return g;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var r=c(i,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,g;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function A(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:M}}function M(){return{value:t,done:!0}}return v.prototype=b.constructor=y,y.constructor=v,y[s]=v.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},w(_.prototype),_.prototype[a]=function(){return this},e.AsyncIterator=_,e.async=function(t,n,i,r){var o=new _(l(t,n,i,r));return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},w(b),b[s]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=A,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return s.type="throw",s.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;L(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:A(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=i}catch(e){Function("r","regeneratorRuntime = r")(i)}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";n.r(t);var i=n(4),r=n.n(i),o=n(6),a=n.n(o),s=n(7),l=n.n(s),c=n(1),u=n.n(c),f=n(5),p=n.n(f),d=n(8),g=n.n(d),h=n(0),v=n(2),y=[0,0,0,255],m={getSourcePosition:{type:"accessor",value:function(e){return e.sourcePosition}},getTargetPosition:{type:"accessor",value:function(e){return e.targetPosition}},getSourceColor:{type:"accessor",value:y},getTargetColor:{type:"accessor",value:y},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},x=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nfloat paraboloid(vec3 source, vec3 target, float ratio) {\n\n  vec3 delta = target - source;\n  float dh = length(delta.xy) * instanceHeights;\n  float unitZ = delta.z / dh;\n  float p2 = unitZ * unitZ + 1.0;\n  float dir = step(delta.z, 0.0);\n  float z0 = mix(source.z, target.z, dir);\n  float r = mix(ratio, 1.0 - ratio, dir);\n  return sqrt(r * (p2 - r)) * dh + z0;\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 getPos(vec3 source, vec3 target, float segmentRatio) {\n  float z = paraboloid(source, target, segmentRatio);\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target.xy - source.xy);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\n\n  return vec3(\n    mix(source.xy, target.xy, segmentRatio) + tilt,\n    z * cos(tiltAngle)\n  );\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  vec3 source = project_position(instanceSourcePositions, instanceSourcePositions64Low);\n  vec3 target = project_position(instanceTargetPositions, instanceTargetPositions64Low);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec3 currPos = getPos(source, target, segmentRatio);\n  vec3 nextPos = getPos(source, target, nextSegmentRatio);\n  vec4 curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n  vec4 next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n  geometry.position = vec4(currPos, 1.0);\n  uv = vec2(segmentRatio, positions.y);\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec3 offset = vec3(\n    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\n  vColor = vec4(color.rgb, color.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  geometry.uv = uv;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:y},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:y},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,r=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r}),r.extensionsChanged){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,r=i.widthUnits,o=i.widthScale,a=i.widthMinPixels,s=i.widthMaxPixels,l="pixels"===r?n.metersPerPixel:1;this.state.model.setUniforms(Object.assign({},t,{widthScale:o*l,widthMinPixels:a,widthMaxPixels:s})).draw()}},{key:"_getModel",value:function(e){for(var t=[],n=0;n<50;n++)t=t.concat([n,-1,0,n,1,0]);var i=new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:5,attributes:{positions:new Float32Array(t)}}),isInstanced:!0}));return i.setUniforms({numSegments:50}),i}}]),t}(h.Layer);x.layerName="ArcLayer",x.defaultProps=m;var P,b=n(9),w=n.n(b),_=(P={},w()(P,10241,9987),w()(P,10240,9729),w()(P,10242,33071),w()(P,10243,33071),P),S=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute vec3 instancePickingColors;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = instancePickingColors;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:"\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor, vec4(color, 1.0), alpha);\n}\n\nvoid main(void) {\n  vec4 bitmapColor = texture2D(bitmapTexture, vTexCoord);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = vTexCoord;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.project32,h.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().add({positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:this.calculatePositions,noAlloc:!0}}),this.setState({numInstances:1,positions:new Float64Array(12)})}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps;if(e.changeFlags.extensionsChanged){var i=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(i)}),this.getAttributeManager().invalidateAll()}t.image!==n.image&&this.loadTexture(t.image);var r=this.getAttributeManager();t.bounds!==n.bounds&&r.invalidate("positions")}},{key:"finalizeState",value:function(){p()(u()(t.prototype),"finalizeState",this).call(this),this.state.bitmapTexture&&this.state.bitmapTexture.delete()}},{key:"calculatePositions",value:function(e){var t=this.state.positions,n=this.props.bounds;if(Number.isFinite(n[0]))t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[0],t[4]=n[3],t[5]=0,t[6]=n[2],t[7]=n[3],t[8]=0,t[9]=n[2],t[10]=n[1],t[11]=0;else for(var i=0;i<n.length;i++)t[3*i+0]=n[i][0],t[3*i+1]=n[i][1],t[3*i+2]=n[i][2]||0;e.value=t}},{key:"_getModel",value:function(e){return e?new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:6,vertexCount:4,attributes:{texCoords:new Float32Array([0,1,0,0,1,0,1,1])}}),isInstanced:!1})):null}},{key:"draw",value:function(e){var t=e.uniforms,n=this.state,i=n.bitmapTexture,r=n.model,o=this.props,a=o.image,s=o.desaturate,l=o.transparentColor,c=o.tintColor;i&&a instanceof HTMLVideoElement&&a.readyState>HTMLVideoElement.HAVE_METADATA&&(i.width!==a.videoWidth||i.height!==a.videoHeight?(i.resize({width:a.videoWidth,height:a.videoHeight,mipmaps:!0}),i.setSubImageData({data:a,paramters:_})):i.setSubImageData({data:a}),i.generateMipmap());i&&r&&r.setUniforms(Object.assign({},t,{bitmapTexture:i,desaturate:s,transparentColor:l.map((function(e){return e/255})),tintColor:c.slice(0,3).map((function(e){return e/255}))})).draw()}},{key:"loadTexture",value:function(e){var t=this.context.gl;this.state.bitmapTexture&&this.state.bitmapTexture.delete(),e instanceof v.Texture2D?this.setState({bitmapTexture:e}):e instanceof HTMLVideoElement?this.setState({bitmapTexture:new v.Texture2D(t,{width:1,height:1,parameters:_,mipmaps:!1})}):e&&this.setState({bitmapTexture:new v.Texture2D(t,{data:e,parameters:_})})}}]),t}(h.Layer);S.layerName="BitmapLayer",S.defaultProps={image:{type:"object",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L=n(3),O=n.n(L);function A(e,t){if(!e)throw new Error(t)}function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e){return(E="function"==typeof Symbol&&"symbol"===M(Symbol.iterator)?function(e){return M(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":M(e)})(e)}var k={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},z=k.global||k.self||k.window,I="object"!==("undefined"==typeof process?"undefined":E(process))||"[object process]"!==String(process)||process.browser,T="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),F=(T&&parseFloat(T[1]),"undefined"!=typeof ImageBitmap),R=void 0!==("undefined"==typeof Image?"undefined":E(Image)),j=Boolean(z._parseImageNode);function D(e){switch(e){case"imagebitmap":return F;case"html":return R;case"ndarray":return j;default:throw new Error("Unknown image format ".concat(e))}}function W(){var e=((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).image||{}).type||"auto";switch(e){case"imagebitmap":case"html":case"ndarray":if(!D(e))throw new Error("Requested image type ".concat(e," not available in current environment"));return e;case"auto":return function(){if(D("ndarray"))return"ndarray";if(D("html"))return"html";if(D("imagebitmap"))return"imagebitmap";if(!I)throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js");return A(!1)}();default:throw new Error("Unknown image format ".concat(e))}}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var G=!1,U=!0,V=new Map([["image/png",{test:function(e){return e.byteLength>=24&&2303741511===e.getUint32(0,G)},getSize:function(e){return{width:e.getUint32(16,G),height:e.getUint32(20,G)}}}],["image/jpeg",{test:function(e){return e.byteLength>=3&&65496===e.getUint16(0,G)&&255===e.getUint8(2,G)},getSize:function(e){if(e.byteLength<2||65496!==e.getUint16(0,G))return null;var t=function(){for(var e=new Set([65499,65476,65484,65501,65534]),t=65504;t<65520;++t)e.add(t);var n=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:n}}(),n=t.tableMarkers,i=t.sofMarkers,r=2;for(;r<e.byteLength;){var o=e.getUint16(r,G);if(i.has(o))return{height:e.getUint16(r+5,G),width:e.getUint16(r+7,G)};if(!n.has(o))return null;r+=2,r+=e.getUint16(r,G)}return null}}],["image/gif",{test:function(e){return e.byteLength>=10&&1195984440===e.getUint32(0,G)},getSize:function(e){return{width:e.getUint16(6,U),height:e.getUint16(8,U)}}}],["image/bmp",{test:function(e){return e.byteLength>=2&&16973===e.getUint16(0,G)},getSize:function(e){return{width:e.getUint32(18,U),height:e.getUint32(22,U)}}}]]);"Invalid MIME type. Supported MIME types are: ".concat(Array.from(V.keys()).join(", "));function H(e){var t=B(e),n=!0,i=!1,r=void 0;try{for(var o,a=V.entries()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=N(o.value,2),l=s[0];if((0,s[1].test)(t))return l}}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return null}function B(e){if((e=e.buffer||e)instanceof ArrayBuffer||ArrayBuffer.isView(e))return new DataView(e.buffer||e);throw new Error("toDataView")}function Z(e,t){A(z._parseImageNode);var n=H(e);return z._parseImageNode(e,n,t)}function K(e,t){var n,i,r;return O.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return"image/jpeg",n=new Blob([e],{type:"image/jpeg"}),i=self.URL||self.webkitURL,r=i.createObjectURL(n),o.prev=4,o.next=7,O.a.awrap(X(r,t));case 7:return o.abrupt("return",o.sent);case 8:return o.prev=8,i.revokeObjectURL(r),o.finish(8);case 11:case"end":return o.stop()}}),null,null,[[4,,8,11]])}function X(e,t){var n;return O.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if((n=new Image).src=e,!(t.image&&t.image.decode&&n.decode)){i.next=6;break}return i.next=5,O.a.awrap(n.decode());case 5:return i.abrupt("return",n);case 6:return i.next=8,O.a.awrap(new Promise((function(t,i){try{n.onload=function(){return t(n)},n.onerror=function(t){return i(new Error("Could not load image ".concat(e,": ").concat(t)))}}catch(e){i(e)}})));case 8:return i.abrupt("return",i.sent);case 9:case"end":return i.stop()}}))}function J(e,t){var n=new Blob([new Uint8Array(e)]),i=t&&t.imagebitmap;return i?createImageBitmap(n):createImageBitmap(n,i)}function Y(e,t){var n,i,r;return O.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return n=new TextDecoder,i=n.decode(e),r="data:image/svg+xml;base64,".concat(btoa(i)),o.next=5,O.a.awrap(X(r,t));case 5:return o.abrupt("return",o.sent);case 6:case"end":return o.stop()}}))}function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Q(e,t,n){var i,r;return O.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if("image"in t&&(t=$({},t,{image:{}})),!(i=(n||{}).url)||!/\.svg((\?|#).*)?$/.test(i)){o.next=7;break}return console.warn("@loaders.gl/images: SVG parsing needs to be fixed for 2.0"),o.next=6,O.a.awrap(Y(e,t));case 6:return o.abrupt("return",o.sent);case 7:r=W(t),o.t0=r,o.next="imagebitmap"===o.t0?11:"html"===o.t0?14:"ndarray"===o.t0?17:20;break;case 11:return o.next=13,O.a.awrap(J(e,t));case 13:return o.abrupt("return",o.sent);case 14:return o.next=16,O.a.awrap(K(e,t));case 16:return o.abrupt("return",o.sent);case 17:return o.next=19,O.a.awrap(Z(e,t));case 19:return o.abrupt("return",o.sent);case 20:return o.abrupt("return",A(!1));case 21:case"end":return o.stop()}}))}function ee(e){var t=ne(e);if(!t)throw new Error("Not an image");return t}function te(e){switch(ee(e)){case"imagebitmap":case"ndarray":return{width:e.width,height:e.height};case"html":return{width:e.naturalWidth,height:e.naturalHeight};default:return A(!1)}}function ne(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"html":e&&"object"===E(e)&&e.data&&e.width&&e.height?"ndarray":Array.isArray(e)?"ndarray":null}function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function re(e,t,n){var i=e;"function"==typeof e&&(i=e(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{},n))),A("string"==typeof i);var r=t.baseUrl;return r&&(i="/"===r[r.length-1]?"".concat(r).concat(i):"".concat(r,"/").concat(i)),i}var oe,ae=function(e){return e&&"object"===E(e)};function se(e,t){var n,i=arguments;return O.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},r.next=3,O.a.awrap(le(e,t,n));case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}))}function le(e,t,n){var i;return O.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!Array.isArray(e)){r.next=4;break}return r.next=3,O.a.awrap(ue(e,t,n));case 3:return r.abrupt("return",r.sent);case 4:if(!ae(e)){r.next=8;break}return r.next=7,O.a.awrap(ce(e,t,n));case 7:return r.abrupt("return",r.sent);case 8:return i=e,r.next=11,O.a.awrap(t(i,n));case 11:return r.abrupt("return",r.sent);case 12:case"end":return r.stop()}}))}function ce(e,t,n){var i,r,o,a;return O.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:for(a in i=[],r={},o=function(o){var a=le(e[o],t,n).then((function(e){r[o]=e}));i.push(a)},e)o(a);return s.next=6,O.a.awrap(Promise.all(i));case 6:return s.abrupt("return",r);case 7:case"end":return s.stop()}}))}function ue(e,t){var n,i,r=arguments;return O.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return n=r.length>2&&void 0!==r[2]?r[2]:{},i=e.map((function(e){return le(e,t,n)})),o.next=4,O.a.awrap(Promise.all(i));case 4:return o.abrupt("return",o.sent);case 5:case"end":return o.stop()}}))}function fe(e,t,n){return O.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,O.a.awrap(se(e,(function(e){return pe(e,t,n)})));case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}}))}function pe(e,t,n){var i,r;return O.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,O.a.awrap(fetch(e,n.fetch));case 2:return i=o.sent,o.next=5,O.a.awrap(i.arrayBuffer());case 5:return r=o.sent,o.next=8,O.a.awrap(t(r,n));case 8:return o.abrupt("return",o.sent);case 9:case"end":return o.stop()}}))}function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function he(e,t){var n,i,r=arguments;return O.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(n=r.length>2&&void 0!==r[2]?r[2]:{},0===(i=t&&t.image&&t.image.mipLevels||0)){o.next=8;break}return o.next=5,O.a.awrap(ve(e,i,t,n));case 5:o.t0=o.sent,o.next=9;break;case 8:o.t0=re(e,t,n);case 9:return o.abrupt("return",o.t0);case 10:case"end":return o.stop()}}))}function ve(e,t,n,i){var r,o,a,s,l,c,u,f;return O.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(r=[],"auto"!==t){p.next=9;break}return o=re(e,n,ge({},i,{lod:0})),p.next=5,O.a.awrap(pe(o,Q,n));case 5:a=p.sent,s=te(a),l=s.width,c=s.height,t=ye({width:l,height:c}),r.push(o);case 9:for(A(t>0),u=r.length;u<t;++u)f=re(e,n,ge({},i,{lod:u})),r.push(f);return p.abrupt("return",r);case 12:case"end":return p.stop()}}))}function ye(e){var t=e.width,n=e.height;return 1+Math.floor(Math.log2(Math.max(t,n)))}var me=1024,xe=4,Pe=function(){},be=(oe={},w()(oe,10241,9987),w()(oe,10240,9729),oe);function we(e){return e&&(e.id||e.url)}function _e(e,t,n){for(var i=0;i<t.length;i++){var r=t[i],o=r.icon,a=r.xOffset;e[we(o)]=Object.assign({},o,{x:a,y:n})}}var Se=function(){function e(t,n){var i=n.onUpdate,o=void 0===i?Pe:i;r()(this,e),this.gl=t,this.onUpdate=o,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=xe,this._canvasWidth=me,this._canvasHeight=0,this._canvas=null}return a()(e,[{key:"finalize",value:function(){this._texture&&this._texture.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(e){var t=this._autoPacking?we(e):e;return this._mapping[t]||{}}},{key:"setProps",value:function(e){var t=e.autoPacking,n=e.iconAtlas,i=e.iconMapping,r=e.data,o=e.getIcon;void 0!==t&&(this._autoPacking=t),o&&(this._getIcon=o),i&&(this._mapping=i),n&&this._updateIconAtlas(n),this._autoPacking&&(r||o)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(r))}},{key:"_updateIconAtlas",value:function(e){this._texture&&(this._texture.delete(),this._texture=null),e instanceof v.Texture2D?(e.setParameters(be),this._externalTexture=e,this.onUpdate()):e&&(this._texture=new v.Texture2D(this.gl,{data:e,parameters:be}),this.onUpdate())}},{key:"_updateAutoPacking",value:function(e){var t,n,i,r,o,a,s=Object.values(function(e,t,n){if(!e||!t)return null;n=n||{};var i={},r=Object(h.createIterable)(e),o=r.iterable,a=r.objectInfo,s=!0,l=!1,c=void 0;try{for(var u,f=o[Symbol.iterator]();!(s=(u=f.next()).done);s=!0){var p=u.value;a.index++;var d=t(p,a),g=we(d);if(!d)throw new Error("Icon is missing.");if(!d.url)throw new Error("Icon url is missing.");i[g]||n[g]&&d.url===n[g].url||(i[g]=d)}}catch(e){l=!0,c=e}finally{try{s||null==f.return||f.return()}finally{if(l)throw c}}return i}(e,this._getIcon,this._mapping)||{});if(s.length>0){var l=function(e){for(var t,n=e.icons,i=e.buffer,r=e.mapping,o=void 0===r?{}:r,a=e.xOffset,s=void 0===a?0:a,l=e.yOffset,c=void 0===l?0:l,u=e.rowHeight,f=void 0===u?0:u,p=e.canvasWidth,d=[],g=0;g<n.length;g++){var h=n[g];if(!o[we(h)]){var v=h.height,y=h.width;s+y+i>p&&(_e(o,d,c),s=0,c=f+c+i,f=0,d=[]),d.push({icon:h,xOffset:s}),s=s+y+i,f=Math.max(f,v)}}return d.length>0&&_e(o,d,c),{mapping:o,rowHeight:f,xOffset:s,yOffset:c,canvasWidth:p,canvasHeight:(t=f+c+i,Math.pow(2,Math.ceil(Math.log2(t))))}}({icons:s,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),c=l.mapping,u=l.xOffset,f=l.yOffset,p=l.rowHeight,d=l.canvasHeight;this._rowHeight=p,this._mapping=c,this._xOffset=u,this._yOffset=f,this._canvasHeight=d,this._texture||(this._texture=new v.Texture2D(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:be})),this._texture.height!==this._canvasHeight&&(this._texture=(this.gl,t=this._texture,n=this._canvasWidth,i=this._canvasHeight,r=t.width,o=t.height,a=Object(v.cloneTextureFrom)(t,{width:n,height:i}),Object(v.copyToTexture)(t,a,{targetY:i-o,width:r,height:o}),t.delete(),a)),this.onUpdate(),this._loadIcons(s)}}},{key:"_loadIcons",value:function(e){var t=this,n=this._canvas.getContext("2d"),i=!0,r=!1,o=void 0;try{for(var a,s=function(){var e=a.value;(function(e){var t,n,i=arguments;return O.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t=i.length>1&&void 0!==i[1]?i[1]:{},r.next=3,O.a.awrap(he(e,t));case 3:return n=r.sent,r.next=6,O.a.awrap(fe(n,Q,t));case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}}))})(e.url).then((function(i){var r=we(e),o=t._mapping[r],a=o.x,s=o.y,l=o.width,c=o.height,u=function(e,t,n,i){var r=t.naturalWidth,o=t.naturalHeight;return n===r&&i===o?t:(e.canvas.height=i,e.canvas.width=n,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,r,o,0,0,n,i),e.canvas)}(n,i,l,c);t._texture.setSubImageData({data:u,x:a,y:s,width:l,height:c}),t._texture.generateMipmap(),t.onUpdate()}))},l=e[Symbol.iterator]();!(i=(a=l.next()).done);i=!0)s()}catch(e){r=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}}}]),e}(),Ce=[0,0,0,255],Le={iconAtlas:{type:"object",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:function(e){return e.position}},getIcon:{type:"accessor",value:function(e){return e.icon}},getColor:{type:"accessor",value:Ce},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0}},Oe=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n",fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.project32,h.picking]})}},{key:"initializeState",value:function(){var e=this;this.state={iconManager:new Se(this.context.gl,{onUpdate:function(){return e._onUpdate()}})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:Ce},instanceAngles:{size:1,transition:!0,accessor:"getAngle",defaultValue:0}})}},{key:"updateState",value:function(e){var n=e.oldProps,i=e.props,r=e.changeFlags;p()(u()(t.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:r});var o=this.getAttributeManager(),a=this.state.iconManager,s=i.iconAtlas,l=i.iconMapping,c=i.data,f=i.getIcon,d=!1;if(s||this.internalState.isAsyncPropLoading("iconAtlas")?(n.iconAtlas!==i.iconAtlas&&a.setProps({iconAtlas:s,autoPacking:!1}),n.iconMapping!==i.iconMapping&&(a.setProps({iconMapping:l}),d=!0)):a.setProps({autoPacking:!0}),(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&(a.setProps({data:c,getIcon:f}),d=!0),d&&(o.invalidate("instanceOffsets"),o.invalidate("instanceIconFrames"),o.invalidate("instanceColorModes")),r.extensionsChanged){var g=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(g)}),o.invalidateAll()}}},{key:"finalizeState",value:function(){p()(u()(t.prototype),"finalizeState",this).call(this),this.state.iconManager.finalize()}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.sizeScale,r=n.sizeMinPixels,o=n.sizeMaxPixels,a=n.sizeUnits,s=n.billboard,l=n.alphaCutoff,c=this.state.iconManager,u=this.context.viewport,f=c.getTexture();f&&f.loaded&&this.state.model.setUniforms(Object.assign({},t,{iconsTexture:f,iconsTextureDim:[f.width,f.height],sizeScale:i*("pixels"===a?u.metersPerPixel:1),sizeMinPixels:r,sizeMaxPixels:o,billboard:s,alphaCutoff:l})).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"getInstanceOffset",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.width/2-t.anchorX||0,t.height/2-t.anchorY||0]}},{key:"getInstanceColorMode",value:function(e){return this.state.iconManager.getIconMapping(e).mask?1:0}},{key:"getInstanceIconFrame",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.x||0,t.y||0,t.width||0,t.height||0]}}]),t}(h.Layer);Oe.layerName="IconLayer",Oe.defaultProps=Le;var Ae={getSourcePosition:{type:"accessor",value:function(e){return e.sourcePosition}},getTargetPosition:{type:"accessor",value:function(e){return e.targetPosition}},getColor:{type:"accessor",value:[0,0,0,255]},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Me=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n  vec4 source_commonspace;\n  vec4 target_commonspace;\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);\n  uv = positions.xy;\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(\n    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME line-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.project32,h.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,r=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r}),r.extensionsChanged){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,r=i.widthUnits,o=i.widthScale,a=i.widthMinPixels,s=i.widthMaxPixels,l="pixels"===r?n.metersPerPixel:1;this.state.model.setUniforms(Object.assign({},t,{widthScale:o*l,widthMinPixels:a,widthMaxPixels:s})).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:5,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0}))}}]),t}(h.Layer);Me.layerName="LineLayer",Me.defaultProps=Ae;var Ee=[0,0,0,255],ke=[0,0,1],ze={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:function(e){return e.position}},getNormal:{type:"accessor",value:ke},getColor:{type:"accessor",value:Ee},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};var Ie=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(e){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.normal = project_normal(instanceNormals);\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(positions.xy * radiusPixels, 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\n  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n  vColor = vec4(lightColor, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.project32,h.gouraudLighting,h.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:ke},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:Ee}})}},{key:"updateState",value:function(e){var n,i,r,o=e.props,a=e.oldProps,s=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:o,oldProps:a,changeFlags:s}),s.extensionsChanged){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),this.getAttributeManager().invalidateAll()}s.dataChanged&&(n=o.data,i=n.header,r=n.attributes,i&&r&&(n.length=i.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0&&(r.instanceColors=r.COLOR_0)))}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,r=i.pointSize,o="meters"===i.sizeUnits?n.distanceScales.pixelsPerMeter[2]:1;this.state.model.setUniforms(Object.assign({},t,{radiusPixels:r*o})).draw()}},{key:"_getModel",value:function(e){for(var t=[],n=0;n<3;n++){var i=n/3*Math.PI*2;t.push(2*Math.cos(i),2*Math.sin(i),0)}return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0}))}}]),t}(h.Layer);Ie.layerName="PointCloudLayer",Ie.defaultProps=ze;var Te=[0,0,0,255],Fe={radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,getPosition:{type:"accessor",value:function(e){return e.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Te},getLineColor:{type:"accessor",value:Te},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Re=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(e){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = smoothedge(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter);\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.project32,h.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,r=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r}),r.extensionsChanged){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,r=i.radiusScale,o=i.radiusMinPixels,a=i.radiusMaxPixels,s=i.stroked,l=i.filled,c=i.lineWidthUnits,u=i.lineWidthScale,f=i.lineWidthMinPixels,p=i.lineWidthMaxPixels,d="pixels"===c?n.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({stroked:s?1:0,filled:l,radiusScale:r,radiusMinPixels:o,radiusMaxPixels:a,lineWidthScale:u*d,lineWidthMinPixels:f,lineWidthMaxPixels:p}).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign(this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}}),isInstanced:!0}))}}]),t}(h.Layer);function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}Re.layerName="ScatterplotLayer",Re.defaultProps=Fe;var De=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r()(this,t);var n=e.id,i=void 0===n?Object(v.uid)("column-geometry"):n,o=function(e){var t=e.radius,n=e.height,i=void 0===n?1:n,r=e.nradial,o=void 0===r?10:r,a=e.vertices;h.log.assert(!a||a.length>=o);for(var s=o+1,l=3*s,c=2*Math.PI/o,u=new Uint16Array(3*o*2),f=new Float32Array(3*l),p=new Float32Array(3*l),d=0,g=0;g<s;g++)for(var v=g*c,y=a&&a[g%o],m=a&&a[(g+1)%o],x=Math.sin(v),P=Math.cos(v),b=0;b<2;b++)f[d+0]=y?y[0]:P*t,f[d+1]=y?y[1]:x*t,f[d+2]=(.5-b)*i,p[d+0]=y?m[0]-y[0]:P,p[d+1]=y?m[1]-y[1]:x,d+=3;for(var w=0;w<s;w++){var _=Math.floor(w/2)*Math.sign(w%2-.5),S=_*c,C=a&&a[(_+o)%o],L=Math.sin(S),O=Math.cos(S);f[d+0]=C?C[0]:O*t,f[d+1]=C?C[1]:L*t,f[d+2]=i/2,p[d+2]=1,d+=3}for(var A=0,M=0;M<o;M++)u[A++]=2*M+0,u[A++]=2*M+2,u[A++]=2*M+0,u[A++]=2*M+1,u[A++]=2*M+1,u[A++]=2*M+3;return{indices:u,attributes:{POSITION:{size:3,value:f},NORMAL:{size:3,value:p}}}}(e),a=o.indices,s=o.attributes;return l()(this,u()(t).call(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(n,!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{id:i,indices:a,attributes:s})))}return g()(t,e),t}(v.Geometry);var We=[0,0,0,255],Ne={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:We},getLineColor:{type:"accessor",value:We},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Ge=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  geometry.pickingColor = instancePickingColors;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.project32,h.gouraudLighting,h.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:We},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:We},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,r=e.changeFlags;p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r});var o=r.extensionsChanged;if(o){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}(o||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices)&&this._updateGeometry(n)}},{key:"getGeometry",value:function(e,t){var n=new De({radius:1,height:2,vertices:t,nradial:e}),i=0;if(t)for(var r=0;r<e;r++){var o=t[r];i+=Math.sqrt(o[0]*o[0]+o[1]*o[1])/e}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*i}),n}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0}))}},{key:"_updateGeometry",value:function(e){var t=e.diskResolution,n=e.vertices,i=this.getGeometry(t,n);this.setState({fillVertexCount:i.attributes.POSITION.value.length/3,wireframeVertexCount:i.indices.value.length}),this.state.model.setProps({geometry:i})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,r=i.lineWidthUnits,o=i.lineWidthScale,a=i.lineWidthMinPixels,s=i.lineWidthMaxPixels,l=i.elevationScale,c=i.extruded,u=i.filled,f=i.stroked,p=i.wireframe,d=i.offset,g=i.coverage,h=i.radius,v=i.angle,y=this.state,m=y.model,x=y.fillVertexCount,P=y.wireframeVertexCount,b=y.edgeDistance,w="pixels"===r?n.metersPerPixel:1;m.setUniforms(Object.assign({},t,{radius:h,angle:v/180*Math.PI,offset:d,extruded:c,coverage:g,elevationScale:l,edgeDistance:b,widthScale:o*w,widthMinPixels:a,widthMaxPixels:s})),c&&p&&(m.setProps({isIndexed:!0}),m.setVertexCount(P).setDrawMode(1).setUniforms({isStroke:!0}).draw()),u&&(m.setProps({isIndexed:!1}),m.setVertexCount(x).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!c&&f&&(m.setProps({isIndexed:!1}),m.setVertexCount(2*x/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}]),t}(h.Layer);Ge.layerName="ColumnLayer",Ge.defaultProps=Ne;var Ue=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getGeometry",value:function(e){return new v.CubeGeometry}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.elevationScale,r=n.extruded,o=n.offset,a=n.coverage,s=n.cellSize,l=n.angle;this.state.model.setUniforms(Object.assign({},t,{radius:s/2,angle:l,offset:o,extruded:r,coverage:a,elevationScale:i,edgeDistance:1,isWireframe:!1})).draw()}}]),t}(Ge);function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}Ue.layerName="GridCellLayer",Ue.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var He=function(e){function t(e){return r()(this,t),l()(this,u()(t).call(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(n,!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{attributes:{positions:{size:3,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})))}return g()(t,e),a()(t,[{key:"getGeometryFromBuffer",value:function(e){return this.normalize?p()(u()(t.prototype),"getGeometryFromBuffer",this).call(this,e):function(){return null}}},{key:"get",value:function(e){return this.attributes[e]}},{key:"getGeometrySize",value:function(e){if(!this.normalize){var t=e.length/this.positionSize;return this.opts.loop?t+2:t}var n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}},{key:"updateGeometryAttributes",value:function(e,t){0!==t.geometrySize&&(this._updateSegmentTypes(e,t),this._updatePositions(e,t))}},{key:"_updateSegmentTypes",value:function(e,t){var n=this.attributes.segmentTypes,i=this.isClosed(e),r=t.vertexStart,o=t.geometrySize;n.fill(0,r,r+o),i?(n[r]=4,n[r+o-2]=4):(n[r]+=1,n[r+o-2]+=2),n[r+o-1]=4}},{key:"_updatePositions",value:function(e,t){var n=this.attributes.positions;if(n)for(var i=t.vertexStart,r=t.geometrySize,o=i,a=0;a<r;o++,a++){var s=this.getPointOnPath(e,a);n[3*o]=s[0],n[3*o+1]=s[1],n[3*o+2]=s[2]||0}}},{key:"getPathLength",value:function(e){return Number.isFinite(e[0])?e.length/this.positionSize:e.length}},{key:"getPointOnPath",value:function(e,t){if(Number.isFinite(e[0])){var n=this.positionSize;return t*n>=e.length&&(t+=1-e.length/n),[e[t*n],e[t*n+1],3===n?e[t*n+2]:0]}return t>=e.length&&(t+=1-e.length),e[t]}},{key:"isClosed",value:function(e){if(!this.normalize)return this.opts.loop;var t=this.getPathLength(e),n=this.getPointOnPath(e,0),i=this.getPointOnPath(e,t-1);return n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]}}]),t}(h.Tesselator),Be=[0,0,0,255],Ze={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},rounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:function(e){return e.path}},getColor:{type:"accessor",value:Be},getWidth:{type:"accessor",value:1}},Ke={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},Xe=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  float relativePosition, bool isEnd, bool isJoint,\n  vec2 width, vec2 widthPixels\n) {\n  vec2 deltaA = (currPoint.xy - prevPoint.xy) / width;\n  vec2 deltaB = (nextPoint.xy - currPoint.xy) / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n  lenA = lenA > EPSILON ? lenA : 0.0;\n  lenB = lenB > EPSILON ? lenB : 0.0;\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  float offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  float cornerPosition = isJoint ?\n    0.0 :\n    flipIfTrue(turnsRight == (relativePosition > 0.0));\n  cornerPosition *=\n    float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) * cosHalfA);\n  if (cornerPosition < 0.0) {\n    offsetScale = min(offsetScale, L / max(cosHalfA, EPSILON));\n  }\n\n  vMiterLength = cornerPosition >= 0.0 ?\n    mix(offsetScale, 0.0, cornerPosition) :\n    offsetScale * cornerPosition;\n  vMiterLength -= sinHalfA * jointType;\n\n  float offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n  cornerPosition = isCap ? (1.0 - positions.z) : 0.;\n  if (isStartCap) {\n    offsetVec = mix(dirB, perpB, cornerPosition);\n  }\n  if (isEndCap) {\n    offsetVec = mix(dirA, perpA, cornerPosition);\n  }\n  if (isCap) {\n    offsetScale = mix(4.0 * jointType, 1.0, cornerPosition);\n    vMiterLength = 1.0 - cornerPosition;\n    offsetDirection = mix(flipIfTrue(isStartCap), positions.y, cornerPosition);\n  }\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vPathLength = L;\n  vec2 offsetFromStartOfPath = vCornerOffset;\n  if (isEnd) {\n    offsetFromStartOfPath += deltaA;\n  }\n  vec2 dir = isEnd ? dirA : dirB;\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(vCornerOffset * widthPixels * isValid, 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  return currPoint + vec3(offset.xy / widthPixels * width, 0.0);\n}\nvec3 lineJoin(vec3 prevPoint, vec3 currPoint, vec3 nextPoint) {\n\n  float relativePosition = positions.y;\n  bool isEnd = positions.x > EPSILON;\n  bool isJoint = positions.z > EPSILON;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n\n  vec2 width = billboard ? project_pixel_size_to_clipspace(widthPixels) : project_pixel_size(widthPixels);\n\n  return lineJoin(\n    prevPoint, currPoint, nextPoint,\n    relativePosition, isEnd, isJoint,\n    width, widthPixels\n  );\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.worldPosition = instanceStartPositions;\n  geometry.worldPositionAlt = instanceEndPositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n  if (jointType > 0.0 && vMiterLength > 0.0 && length(vCornerOffset) > 1.0) {\n    discard;\n  }\n  if (jointType == 0.0 && vMiterLength > miterLimit) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.project32,h.picking]})}},{key:"initializeState",value:function(){var e=this;this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Ke,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Ke,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Ke,defaultValue:Be},instancePickingColors:{size:3,type:5121,accessor:function(t,n){var i=n.index,r=n.target;return e.encodePickingColor(i,r)}}}),this.setState({pathTesselator:new He({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&h.log.removed("getDashArray","PathStyleExtension")()}},{key:"updateState",value:function(e){var n=e.oldProps,i=e.props,r=e.changeFlags;p()(u()(t.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:r});var o=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){var a=this.state.pathTesselator,s=i.data.attributes||{};a.updateGeometry({data:i.data,geometryBuffer:s.getPath,buffers:s,normalize:!i._pathType,loop:"loop"===i._pathType,getGeometry:i.getPath,positionFormat:i.positionFormat,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||o.invalidateAll()}if(r.extensionsChanged){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),o.invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,r=i.rounded,o=i.billboard,a=i.miterLimit,s=i.widthUnits,l=i.widthScale,c=i.widthMinPixels,u=i.widthMaxPixels,f="pixels"===s?n.metersPerPixel:1;this.state.model.setUniforms(Object.assign({},t,{jointType:Number(r),billboard:o,widthScale:l*f,miterLimit:a,widthMinPixels:c,widthMaxPixels:u})).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:4,attributes:{indices:new Uint16Array([0,2,1,1,2,4,1,4,3,3,4,5]),positions:new Float32Array([0,0,1,0,-1,0,0,1,0,1,-1,0,1,1,0,1,0,1])}}),isInstanced:!0}))}},{key:"calculatePositions",value:function(e){var t=this.state.pathTesselator;e.startIndices=t.vertexStarts,e.value=t.get("positions")}},{key:"calculateSegmentTypes",value:function(e){var t=this.state.pathTesselator;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}]),t}(h.Layer);Xe.layerName="PathLayer",Xe.defaultProps=Ze;var Je=n(11),Ye=n.n(Je),qe=Math.PI/4,$e=Math.PI/360;function Qe(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function et(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function tt(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function nt(e,t,n,i){for(var r=0;r<t;r++)if(e[n+r]!==e[i-t+r])return!1;return!0}function it(e,t,n,i){for(var r=t,o=n.length,a=0;a<o;a++)for(var s=0;s<i;s++)e[r++]=n[a][s]||0;if(!tt(n))for(var l=0;l<i;l++)e[r++]=n[0][l]||0;return r}function rt(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,a=(o=o||n.length)-r;if(a<=0)return t;for(var s=t,l=0;l<a;l++)e[s++]=n[r+l];if(!nt(n,i,r,o))for(var c=0;c<i;c++)e[s++]=n[r+c];return s}function ot(e){return(tt(e)?0:1)+e.length}function at(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;return n>=(i=i||e.length)?0:(nt(e,t,n,i)?0:1)+(i-n)/t}function st(e,t){if(!(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]))return(e=e.positions||e).length/t;if(Qe(e),e.positions){var n=e,i=n.positions,r=n.holeIndices;if(r){for(var o=0,a=0;a<=r.length;a++)o+=at(e.positions,t,r[a-1],r[a]);return o}e=i}if(Number.isFinite(e[0]))return at(e,t);if(!et(e)){var s=0,l=!0,c=!1,u=void 0;try{for(var f,p=e[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){s+=ot(f.value)}}catch(e){c=!0,u=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw u}}return s}return ot(e)}function lt(e,t,n){Qe(e),n=n||st(e,t);var i=new Float64Array(n*t),r=[];if(e.positions){var o=e,a=o.positions,s=o.holeIndices;if(s){for(var l=0,c=0;c<=s.length;c++)l=rt(i,l,a,t,s[c-1],s[c]),r.push(l);return r.pop(),{positions:i,holeIndices:r}}e=a}if(Number.isFinite(e[0]))return rt(i,0,e,t),i;if(!et(e)){var u=0,f=!0,p=!1,d=void 0;try{for(var g,h=e[Symbol.iterator]();!(f=(g=h.next()).done);f=!0){u=it(i,u,g.value,t),r.push(u)}}catch(e){p=!0,d=e}finally{try{f||null==h.return||h.return()}finally{if(p)throw d}}return r.pop(),{positions:i,holeIndices:r}}return it(i,0,e,t),i}function ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}var ut=function(e){function t(e){r()(this,t);var n=e.fp64,i=e.IndexType,o=void 0===i?Uint32Array:i;return l()(this,u()(t).call(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ct(n,!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ct(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:o,size:1}}})))}return g()(t,e),a()(t,[{key:"get",value:function(e){var t=this.attributes;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}},{key:"updateGeometry",value:function(e){p()(u()(t.prototype),"updateGeometry",this).call(this,e);var n=this.buffers.indices;n&&(this.vertexCount=(n.value||n).length)}},{key:"getGeometrySize",value:function(e){return st(e,this.positionSize,this.normalize)}},{key:"getGeometryFromBuffer",value:function(e){var n=p()(u()(t.prototype),"getGeometryFromBuffer",this).call(this,e);return this.normalize||!this.buffers.indices?n:function(){return null}}},{key:"updateGeometryAttributes",value:function(e,t){this.normalize&&(e=lt(e,this.positionSize,t.geometrySize)),this._updateIndices(e,t),this._updatePositions(e,t),this._updateVertexValid(e,t)}},{key:"_updateIndices",value:function(e,t){var n=t.geometryIndex,i=t.vertexStart,r=t.indexStart,o=this.attributes,a=this.indexStarts,s=this.typedArrayManager,l=o.indices;if(l){var c=r,u=function(e,t,n){var i=null;e.holeIndices&&(i=e.holeIndices.map((function(e){return e/t})));var r=e.positions||e;if(n){var o=r.length;r=r.slice();for(var a=0;a<o;a+=t){var s=r[a+1];r[a+1]=Math.log(Math.tan(qe+s*$e))}}return Ye()(r,i,t)}(e,this.positionSize,this.opts.preproject);l=s.allocate(l,r+u.length,{copy:!0});for(var f=0;f<u.length;f++)l[c++]=u[f]+i;a[n+1]=r+u.length,o.indices=l}}},{key:"_updatePositions",value:function(e,t){var n=t.vertexStart,i=t.geometrySize,r=this.attributes.positions,o=this.positionSize;if(r)for(var a=e.positions||e,s=n,l=0;l<i;s++,l++){var c=a[l*o],u=a[l*o+1],f=o>2?a[l*o+2]:0;r[3*s]=c,r[3*s+1]=u,r[3*s+2]=f}}},{key:"_updateVertexValid",value:function(e,t){var n=t.vertexStart,i=t.geometrySize,r=this.attributes.vertexValid,o=this.positionSize,a=e&&e.holeIndices;if(r.fill(1,n,n+i),a)for(var s=0;s<a.length;s++)r[n+a[s]/o-1]=0;r[n+i-1]=0}}]),t}(h.Tesselator),ft="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n  isValid = vertexValid;\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n  isValid = 1.0;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n    \n#ifdef IS_SIDE_VERTEX\n    normal = vec3(props.positions.y - props.nextPositions.y, props.nextPositions.x - props.positions.x, 0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n    geometry.normal = normal;\n  }\n\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",pt="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(ft,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),dt="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(ft,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = instancePositions;\n  props.positions64Low = instancePositions64Low;\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n  props.nextPositions = nextPositions;\n  props.nextPositions64Low = nextPositions64Low;\n\n  calculatePosition(props);\n}\n"),gt=[0,0,0,255],ht={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(e){return e.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:gt},getLineColor:{type:"accessor",value:gt},material:!0},vt={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},yt=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(e){return p()(u()(t.prototype),"getShaders",this).call(this,{vs:e,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid < 0.5) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",defines:{},modules:[h.project32,h.gouraudLighting,h.picking]})}},{key:"initializeState",value:function(){var e=this,t=this.context,n=t.gl,i=t.viewport,r=this.props.coordinateSystem;i.isGeospatial&&r===h.COORDINATE_SYSTEM.DEFAULT&&(r=h.COORDINATE_SYSTEM.LNGLAT),this.setState({numInstances:0,polygonTesselator:new ut({preproject:r===h.COORDINATE_SYSTEM.LNGLAT,fp64:this.use64bitPositions(),IndexType:!n||Object(v.hasFeature)(n,v.FEATURES.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var o=this.getAttributeManager();o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:vt,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:vt,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:vt,accessor:"getFillColor",defaultValue:gt,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:vt,accessor:"getLineColor",defaultValue:gt,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(t,n){var i=n.index,r=n.target;return e.encodePickingColor(i,r)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.extruded,r=n.filled,o=n.wireframe,a=n.elevationScale,s=this.state,l=s.topModel,c=s.sideModel,u=s.polygonTesselator,f=Object.assign({},t,{extruded:Boolean(i),elevationScale:a});c&&(c.setInstanceCount(u.instanceCount-1),c.setUniforms(f),o&&(c.setDrawMode(3),c.setUniforms({isWireframe:!0}).draw()),r&&(c.setDrawMode(6),c.setUniforms({isWireframe:!1}).draw())),l&&(l.setVertexCount(u.vertexCount),l.setUniforms(f).draw())}},{key:"updateState",value:function(e){p()(u()(t.prototype),"updateState",this).call(this,e),this.updateGeometry(e);var n=e.props,i=e.oldProps,r=e.changeFlags,o=this.getAttributeManager();(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded)&&(this.state.models&&this.state.models.forEach((function(e){return e.delete()})),this.setState(this._getModels(this.context.gl)),o.invalidateAll())}},{key:"updateGeometry",value:function(e){var t=e.props,n=(e.oldProps,e.changeFlags);if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){var i=this.state.polygonTesselator,r=t.data.attributes||{};i.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:r.getPolygon,buffers:r,getGeometry:t.getPolygon,positionFormat:t.positionFormat,fp64:this.use64bitPositions(),dataChanged:n.dataChanged}),this.setState({numInstances:i.instanceCount,startIndices:i.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(e){var t,n,i=this.props,r=i.id,o=i.filled,a=i.extruded;if(o){var s=this.getShaders(pt);s.defines.NON_INSTANCED_MODEL=1,t=new v.Model(e,Object.assign({},s,{id:"".concat(r,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0}))}return a&&((n=new v.Model(e,Object.assign({},this.getShaders(dt),{id:"".concat(r,"-side"),geometry:new v.Geometry({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,1,0,1,0,0,1,0])}}}),instanceCount:0,isInstanced:1}))).userData.excludeAttributes={indices:!0}),{models:[n,t].filter(Boolean),topModel:t,sideModel:n}}},{key:"calculateIndices",value:function(e){var t=this.state.polygonTesselator;e.startIndices=t.indexStarts,e.value=t.get("indices")}},{key:"calculatePositions",value:function(e){var t=this.state.polygonTesselator;e.startIndices=t.vertexStarts,e.value=t.get("positions")}},{key:"calculateVertexValid",value:function(e){e.value=this.state.polygonTesselator.get("vertexValid")}}]),t}(h.Layer);function mt(e){for(var t=e.data,n=e.getIndex,i=e.dataRange,r=e.replace,o=i.startRow,a=void 0===o?0:o,s=i.endRow,l=void 0===s?1/0:s,c=t.length,u=c,f=c,p=0;p<c;p++){var d=n(t[p]);if(u>p&&d>=a&&(u=p),d>=l){f=p;break}}for(var g=u,h=f-u!==r.length,v=h&&t.slice(f),y=0;y<r.length;y++)t[g++]=r[y];if(h){for(var m=0;m<v.length;m++)t[g++]=v[m];t.length=g}return{startRow:u,endRow:u+r.length}}yt.layerName="SolidPolygonLayer",yt.defaultProps=ht;var xt={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:function(e){return e.polygon}},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},Pt=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"initializeState",value:function(){this.state={paths:[]},this.props.getLineDashArray&&h.log.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(e){var t=this,n=(e.oldProps,e.props,e.changeFlags),i=n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon);if(i&&Array.isArray(n.dataChanged)){var r=this.state.paths.slice(),o=n.dataChanged.map((function(e){return mt({data:r,getIndex:function(e){return e.__source.index},dataRange:e,replace:t._getPaths(e)})}));this.setState({paths:r,pathsDiff:o})}else i&&this.setState({paths:this._getPaths(),pathsDiff:null})}},{key:"_getPaths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.props,n=t.data,i=t.getPolygon,r=t.positionFormat,o=t._normalize,a=[],s="XY"===r?2:3,l=e.startRow,c=e.endRow,u=Object(h.createIterable)(n,l,c),f=u.iterable,p=u.objectInfo,d=!0,g=!1,v=void 0;try{for(var y,m=f[Symbol.iterator]();!(d=(y=m.next()).done);d=!0){var x=y.value;p.index++;var P=i(x,p);o&&(P=lt(P,s));var b=P,w=b.holeIndices,_=P.positions||P;if(w)for(var S=0;S<=w.length;S++){var C=_.subarray(w[S-1]||0,w[S]||_.length);a.push(this.getSubLayerRow({path:C},x,p.index))}else a.push(this.getSubLayerRow({path:_},x,p.index))}}catch(e){g=!0,v=e}finally{try{d||null==m.return||m.return()}finally{if(g)throw v}}return a}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e._dataDiff,i=e.stroked,r=e.filled,o=e.extruded,a=e.wireframe,s=e._normalize,l=e.elevationScale,c=e.transitions,u=e.positionFormat,f=this.props,p=f.lineWidthUnits,d=f.lineWidthScale,g=f.lineWidthMinPixels,h=f.lineWidthMaxPixels,v=f.lineJointRounded,y=f.lineMiterLimit,m=f.lineDashJustified,x=this.props,P=x.getFillColor,b=x.getLineColor,w=x.getLineWidth,_=x.getLineDashArray,S=x.getElevation,C=x.getPolygon,L=x.updateTriggers,O=x.material,A=this.state,M=A.paths,E=A.pathsDiff,k=this.getSubLayerClass("fill",yt),z=this.getSubLayerClass("stroke",Xe),I=this.shouldRenderSubLayer("fill",M)&&new k({_dataDiff:n,extruded:o,elevationScale:l,filled:r,wireframe:a,_normalize:s,getElevation:S,getFillColor:P,getLineColor:b,material:O,transitions:c},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:L.getPolygon,getElevation:L.getElevation,getFillColor:L.getFillColor,getLineColor:L.getLineColor}}),{data:t,positionFormat:u,getPolygon:C});return[!o&&I,!o&&i&&this.shouldRenderSubLayer("stroke",M)&&new z({_dataDiff:E&&function(){return E},widthUnits:p,widthScale:d,widthMinPixels:g,widthMaxPixels:h,rounded:v,miterLimit:y,dashJustified:m,_pathType:"loop",transitions:c&&{getWidth:c.getLineWidth,getColor:c.getLineColor,getPath:c.getPolygon},getColor:this.getSubLayerAccessor(b),getWidth:this.getSubLayerAccessor(w),getDashArray:this.getSubLayerAccessor(_)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:L.getLineWidth,getColor:L.getLineColor,getDashArray:L.getLineDashArray}}),{data:M,positionFormat:u,getPath:function(e){return e.path}}),o&&I]}}]),t}(h.CompositeLayer);function bt(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},r=n.startRow,o=void 0===r?0:r,a=n.endRow,s=void 0===a?e.length:a,l=o;l<s;l++){var c=e[l];h.log.assert(c&&c.geometry,"GeoJSON does not have geometry");var u=c.geometry;if("GeometryCollection"===u.type){h.log.assert(Array.isArray(u.geometries),"GeoJSON does not have geometries array");for(var f=u.geometries,p=0;p<f.length;p++){wt(f[p],i,t,c,l)}}else wt(u,i,t,c,l)}return i}function wt(e,t,n,i,r){var o=e.type,a=e.coordinates,s=t.pointFeatures,l=t.lineFeatures,c=t.polygonFeatures,u=t.polygonOutlineFeatures;if(function(e,t){var n=_t[e];h.log.assert(n,"Unknown GeoJSON type ".concat(e));for(;t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(o,a))switch(o){case"Point":s.push(n({geometry:e},i,r));break;case"MultiPoint":a.forEach((function(e){s.push(n({geometry:{type:"Point",coordinates:e}},i,r))}));break;case"LineString":l.push(n({geometry:e},i,r));break;case"MultiLineString":a.forEach((function(e){l.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}));break;case"Polygon":c.push(n({geometry:e},i,r)),a.forEach((function(e){u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}));break;case"MultiPolygon":a.forEach((function(e){c.push(n({geometry:{type:"Polygon",coordinates:e}},i,r)),e.forEach((function(e){u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}))}))}else h.log.warn("".concat(o," coordinates are malformed"))()}Pt.layerName="PolygonLayer",Pt.defaultProps=xt;var _t={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};var St={stroked:!0,filled:!0,extruded:!1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,elevationScale:1,pointRadiusScale:1,pointRadiusMinPixels:0,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,getLineColor:{type:"accessor",value:[0,0,0,255]},getFillColor:{type:"accessor",value:[0,0,0,255]},getRadius:{type:"accessor",value:1},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};function Ct(e){return e.geometry.coordinates}var Lt=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"initializeState",value:function(){this.state={features:{}},this.props.getLineDashArray&&h.log.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(e){var t=e.props,n=e.changeFlags;if(n.dataChanged){var i=function(e){if(Array.isArray(e))return e;switch(h.log.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return h.log.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(t.data),r=this.getSubLayerRow.bind(this);if(Array.isArray(n.dataChanged)){var o=this.state.features,a={},s={};for(var l in o)a[l]=o[l].slice(),s[l]=[];var c=!0,u=!1,f=void 0;try{for(var p,d=n.dataChanged[Symbol.iterator]();!(c=(p=d.next()).done);c=!0){var g=p.value,v=bt(i,r,g);for(var y in o)s[y].push(mt({data:a[y],getIndex:function(e){return e.__source.index},dataRange:g,replace:v[y]}))}}catch(e){u=!0,f=e}finally{try{c||null==d.return||d.return()}finally{if(u)throw f}}this.setState({features:a,featuresDiff:s})}else this.setState({features:bt(i,r),featuresDiff:{}})}}},{key:"renderLayers",value:function(){var e=this.state,t=e.features,n=e.featuresDiff,i=t.pointFeatures,r=t.lineFeatures,o=t.polygonFeatures,a=t.polygonOutlineFeatures,s=this.props,l=s.stroked,c=s.filled,u=s.extruded,f=s.wireframe,p=s.material,d=s.transitions,g=this.props,h=g.lineWidthUnits,v=g.lineWidthScale,y=g.lineWidthMinPixels,m=g.lineWidthMaxPixels,x=g.lineJointRounded,P=g.lineMiterLimit,b=g.pointRadiusScale,w=g.pointRadiusMinPixels,_=g.pointRadiusMaxPixels,S=g.elevationScale,C=g.lineDashJustified,L=this.props,O=L.getLineColor,A=L.getFillColor,M=L.getRadius,E=L.getLineWidth,k=L.getLineDashArray,z=L.getElevation,I=L.updateTriggers,T=this.getSubLayerClass("polygons-fill",yt),F=this.getSubLayerClass("polygons-stroke",Xe),R=this.getSubLayerClass("line-strings",Xe),j=this.getSubLayerClass("points",Re),D=this.shouldRenderSubLayer("polygons-fill",o)&&new T({_dataDiff:n.polygonFeatures&&function(){return n.polygonFeatures},extruded:u,elevationScale:S,filled:c,wireframe:f,material:p,getElevation:this.getSubLayerAccessor(z),getFillColor:this.getSubLayerAccessor(A),getLineColor:this.getSubLayerAccessor(O),transitions:d&&{getPolygon:d.geometry,getElevation:d.getElevation,getFillColor:d.getFillColor,getLineColor:d.getLineColor}},this.getSubLayerProps({id:"polygons-fill",updateTriggers:{getElevation:I.getElevation,getFillColor:I.getFillColor,getLineColor:I.getLineColor}}),{data:o,getPolygon:Ct});return[!u&&D,!u&&l&&this.shouldRenderSubLayer("polygons-stroke",a)&&new F({_dataDiff:n.polygonOutlineFeatures&&function(){return n.polygonOutlineFeatures},widthUnits:h,widthScale:v,widthMinPixels:y,widthMaxPixels:m,rounded:x,miterLimit:P,dashJustified:C,getColor:this.getSubLayerAccessor(O),getWidth:this.getSubLayerAccessor(E),getDashArray:this.getSubLayerAccessor(k),transitions:d&&{getPath:d.geometry,getColor:d.getLineColor,getWidth:d.getLineWidth}},this.getSubLayerProps({id:"polygons-stroke",updateTriggers:{getColor:I.getLineColor,getWidth:I.getLineWidth,getDashArray:I.getLineDashArray}}),{data:a,getPath:Ct}),this.shouldRenderSubLayer("linestrings",r)&&new R({_dataDiff:n.lineFeatures&&function(){return n.lineFeatures},widthUnits:h,widthScale:v,widthMinPixels:y,widthMaxPixels:m,rounded:x,miterLimit:P,dashJustified:C,getColor:this.getSubLayerAccessor(O),getWidth:this.getSubLayerAccessor(E),getDashArray:this.getSubLayerAccessor(k),transitions:d&&{getPath:d.geometry,getColor:d.getLineColor,getWidth:d.getLineWidth}},this.getSubLayerProps({id:"line-strings",updateTriggers:{getColor:I.getLineColor,getWidth:I.getLineWidth,getDashArray:I.getLineDashArray}}),{data:r,getPath:Ct}),this.shouldRenderSubLayer("points",i)&&new j({_dataDiff:n.pointFeatures&&function(){return n.pointFeatures},stroked:l,filled:c,radiusScale:b,radiusMinPixels:w,radiusMaxPixels:_,lineWidthUnits:h,lineWidthScale:v,lineWidthMinPixels:y,lineWidthMaxPixels:m,getFillColor:this.getSubLayerAccessor(A),getLineColor:this.getSubLayerAccessor(O),getRadius:this.getSubLayerAccessor(M),getLineWidth:this.getSubLayerAccessor(E),transitions:d&&{getPosition:d.geometry,getFillColor:d.getFillColor,getLineColor:d.getLineColor,getRadius:d.getRadius,getLineWidth:d.getLineWidth}},this.getSubLayerProps({id:"points",updateTriggers:{getFillColor:I.getFillColor,getLineColor:I.getLineColor,getRadius:I.getRadius,getLineWidth:I.getLineWidth}}),{data:i,getPosition:Ct}),u&&D]}}]),t}(h.CompositeLayer);Lt.layerName="GeoJsonLayer",Lt.defaultProps=St;var Ot=n(10),At=n.n(Ot),Mt=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"getShaders",value:function(){return Object.assign({},p()(u()(t.prototype),"getShaders",this).call(this),{vs:"#define SHADER_NAME multi-icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec2 iconsTextureDim;\nuniform float gamma;\nuniform float opacity;\nuniform bool billboard;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying float vGamma;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale),\n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n  \n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position); \n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vGamma = gamma / (sizeScale * iconSize.y);\n}\n",fs:"#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform sampler2D iconsTexture;\nuniform float buffer;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform bool shouldDrawBackground;\nuniform vec3 backgroundColor;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying float vGamma;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  float alpha = texture2D(iconsTexture, vTextureCoords).a;\n  if (sdf) {\n    alpha = smoothstep(buffer - vGamma, buffer + vGamma, alpha);\n  }\n  float a = alpha * vColor.a;\n  \n  if (a < alphaCutoff) {\n    if (shouldDrawBackground && !picking_uActive) {\n      gl_FragColor = vec4(backgroundColor, vColor.a);\n      return;\n    } else if (!picking_uActive) {\n      discard;\n    }\n  }\n\n  if (shouldDrawBackground) {\n    gl_FragColor = vec4(mix(backgroundColor, vColor.rgb, alpha), vColor.a);\n  } else {\n    gl_FragColor = vec4(vColor.rgb, a);\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"})}},{key:"initializeState",value:function(){p()(u()(t.prototype),"initializeState",this).call(this),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:["getIcon","getAnchorX","getAnchorY"],update:this.calculateInstanceOffsets},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"},instancePickingColors:{type:5121,size:3,update:this.calculateInstancePickingColors}})}},{key:"updateState",value:function(e){p()(u()(t.prototype),"updateState",this).call(this,e);var n=e.changeFlags,i=e.oldProps,r=e.props;if(n.updateTriggersChanged&&(n.updateTriggersChanged.getAnchorX||n.updateTriggersChanged.getAnchorY)&&this.getAttributeManager().invalidate("instanceOffsets"),r.backgroundColor!==i.backgroundColor){var o=Array.isArray(r.backgroundColor)?r.backgroundColor.map((function(e){return e/255})).slice(0,3):null;this.setState({backgroundColor:o})}}},{key:"draw",value:function(e){var n=e.uniforms,i=this.props.sdf,r=this.state.backgroundColor,o=Array.isArray(r);p()(u()(t.prototype),"draw",this).call(this,{uniforms:Object.assign({},n,{buffer:.75,gamma:.2,sdf:Boolean(i),backgroundColor:r||[0,0,0],shouldDrawBackground:o})})}},{key:"calculateInstanceOffsets",value:function(e,t){var n=t.startRow,i=t.endRow,r=this.props,o=r.data,a=r.iconMapping,s=r.getIcon,l=r.getAnchorX,c=r.getAnchorY,u=r.getParagraphSize,f=r.getRowSize,p=r.getOffsets,d=e.value,g=n*e.size,v=Object(h.createIterable)(o,n,i).iterable,y=!0,m=!1,x=void 0;try{for(var P,b=v[Symbol.iterator]();!(y=(P=b.next()).done);y=!0){var w=P.value,_=a[s(w)]||{},S=u(w),C=At()(S,2),L=C[0],O=C[1],A=f(w),M=At()(A,1)[0],E=p(w),k=At()(E,2),z=k[0],I=k[1],T=l(w),F=c(w),R=(1-T)*(L-M)/2;d[g++]=(T-1)*L/2+R+_.width/2+z||0,d[g++]=(F-1)*O/2+_.height/2+I||0}}catch(e){m=!0,x=e}finally{try{y||null==b.return||b.return()}finally{if(m)throw x}}}},{key:"calculateInstancePickingColors",value:function(e,t){var n=t.startRow,i=t.endRow,r=this.props,o=r.data,a=r.getPickingIndex,s=e.value,l=n*e.size,c=[],u=Object(h.createIterable)(o,n,i).iterable,f=!0,p=!1,d=void 0;try{for(var g,v=u[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var y=a(g.value);this.encodePickingColor(y,c),s[l++]=c[0],s[l++]=c[1],s[l++]=c[2]}}catch(e){p=!0,d=e}finally{try{f||null==v.return||v.return()}finally{if(p)throw d}}}}]),t}(Oe);Mt.layerName="MultiIconLayer",Mt.defaultProps={backgroundColor:{type:"color",value:null,optional:!0},getRowSize:{type:"accessor",value:function(e){return e.rowSize||[0,0]}},getOffsets:{type:"accessor",value:function(e){return e.offsets||[0,0]}},getParagraphSize:{type:"accessor",value:function(e){return e.size||[1,1]}},getAnchorX:{type:"accessor",value:function(e){return e.anchorX||0}},getAnchorY:{type:"accessor",value:function(e){return e.anchorY||0}},getPixelOffset:{type:"accessor",value:[0,0]},getPickingIndex:{type:"accessor",value:function(e){return e.objectIndex}}};var Et=n(12),kt=n.n(Et),zt=32;function It(e,t){for(var n=0,i=0;i<e.length;i++){var r=e[i],o=null,a=t&&t[r];a?o=a.width:(h.log.warn("Missing character: ".concat(r))(),o=zt),n+=o}return n}function Tt(e,t,n){for(var i=[],r=0,o=0,a=0;a<e.length;a++){var s=It(e[a],n);o+s>t&&(r<a&&i.push(e.substring(r,a)),r=a,o=0),o+=s}return r<e.length&&i.push(e.substring(r)),{rows:i,lastRowStartCharIndex:r,lastRowOffsetLeft:o}}function Ft(e,t,n,i){return"break-all"===t?Tt(e,n,i):function(e,t,n){for(var i=[],r=0,o=0,a=0,s=null,l=0;l<e.length;l++)if(" "===e[l]?(s=e[l],o=l+1):l+1<e.length&&" "===e[l+1]||l+1===e.length?(s=e.substring(o,l+1),o=l+1):s=null,s){var c=It(s,n);if(a+c>t){var u=o-s.length;if(r<u&&(i.push(e.substring(r,u)),r=u,a=0),c>t){var f=Tt(s,t,n);f.rows.length>1&&(i=i.concat(f.rows.slice(0,f.rows.length-1))),r+=f.lastRowStartCharIndex,c=f.lastRowOffsetLeft}}a+=c}return r<e.length&&i.push(e.substring(r)),{rows:i,lastRowStartCharIndex:r,lastRowOffsetLeft:a}}(e,n,i)}function Rt(e,t,n,i){var r=0,o=0,a=[],s=!0,l=!1,c=void 0;try{for(var u,f=e[Symbol.iterator]();!(s=(u=f.next()).done);s=!0){var p=u.value,d={text:p,offsetTop:i,offsetLeft:r},g=t[p];g?(o||(o=g.height*n),r+=g.width):(h.log.warn("Missing character: ".concat(p))(),r+=zt),a.push(d)}}catch(e){l=!0,c=e}finally{try{s||null==f.return||f.return()}finally{if(l)throw c}}return{characters:a,rowWidth:r,rowHeight:o}}function jt(e,t,n,i,r,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];if(e){var s=("break-word"===n||"break-all"===n)&&isFinite(i)&&i>0,l=[0,0],c=0,u=e.split("\n"),f=!0,p=!1,d=void 0;try{for(var g,h=u[Symbol.iterator]();!(f=(g=h.next()).done);f=!0){var v=g.value,y=[v];s&&(y=Ft(v,n,i,r).rows);var m=!0,x=!1,P=void 0;try{for(var b,w=y[Symbol.iterator]();!(m=(b=w.next()).done);m=!0){var _=Rt(b.value,r,t,c),S=_.rowWidth,C=_.rowHeight,L=_.characters,O=[S,C],A=!0,M=!1,E=void 0;try{for(var k,z=L[Symbol.iterator]();!(A=(k=z.next()).done);A=!0){var I=k.value;I.size=l,I.rowSize=O,a.push(o(I))}}catch(e){M=!0,E=e}finally{try{A||null==z.return||z.return()}finally{if(M)throw E}}c+=C,l[0]=s?i:Math.max(l[0],S)}}catch(e){x=!0,P=e}finally{try{m||null==w.return||w.return()}finally{if(x)throw P}}}}catch(e){p=!0,d=e}finally{try{f||null==h.return||h.return()}finally{if(p)throw d}}l[1]=c}}var Dt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;r()(this,e),this.limit=t,this.clear()}return a()(e,[{key:"clear",value:function(){this._cache={},this._order=[]}},{key:"get",value:function(e){var t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}},{key:"set",value:function(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}},{key:"delete",value:function(e){this._cache[e]&&(this._deleteCache(e),this._deleteOrder(e))}},{key:"_deleteCache",value:function(e){delete this._cache[e]}},{key:"_deleteOrder",value:function(e){var t=this._order.findIndex((function(t){return t===e}));t>=0&&this._order.splice(t,1)}},{key:"_appendOrder",value:function(e){this._order.push(e)}}]),e}();var Wt=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),Nt="Monaco, monospace",Gt="normal",Ut=64,Vt=2,Ht=.25,Bt=3,Zt=new Dt(3),Kt=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function Xt(e,t){var n=Zt.get(e);if(!n)return t;var i=[],r=n.mapping,o=Object.keys(r);o=new Set(o);var a=t;return a instanceof Array&&(a=new Set(a)),a.forEach((function(e){o.has(e)||i.push(e)})),i}function Jt(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function Yt(e,t,n,i){e.font="".concat(i," ").concat(n,"px ").concat(t),e.fillStyle="#000",e.textBaseline="baseline",e.textAlign="left"}var qt=function(){function e(t){r()(this,e),this.gl=t,this.props={fontFamily:Nt,fontWeight:Gt,characterSet:Wt,fontSize:Ut,buffer:Vt,sdf:!1,cutoff:Ht,radius:Bt},this._key=null,this._texture=new v.Texture2D(this.gl)}return a()(e,[{key:"finalize",value:function(){this._texture.delete()}},{key:"setProps",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Kt.forEach((function(n){n in t&&(e.props[n]=t[n])}));var n=this._key;this._key=this._getKey();var i=Xt(this._key,this.props.characterSet),r=Zt.get(this._key);if(r&&0===i.length)this._key!==n&&this._updateTexture(r);else{var o=this._generateFontAtlas(this._key,i,r);this._updateTexture(o),Zt.set(this._key,o)}}},{key:"_updateTexture",value:function(e){var t,n=e.data,i=e.width,r=e.height;this._texture.width===i&&this._texture.height===r||this._texture.resize({width:i,height:r}),this._texture.setImageData({data:n,width:i,height:r,parameters:(t={},w()(t,10242,33071),w()(t,10243,33071),t)}),this._texture.generateMipmap()}},{key:"_generateFontAtlas",value:function(e,t,n){var i=this.props,r=i.fontFamily,o=i.fontWeight,a=i.fontSize,s=i.buffer,l=i.sdf,c=i.radius,u=i.cutoff,f=n&&n.data;f||((f=document.createElement("canvas")).width=1024);var p=f.getContext("2d");Yt(p,r,a,o);var d=function(e){var t=e.characterSet,n=e.getFontWidth,i=e.fontHeight,r=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,l=e.xOffset,c=void 0===l?0:l,u=e.yOffset,f=void 0===u?0:u,p=0,d=c,g=0,h=!0,v=!1,y=void 0;try{for(var m,x=t[Symbol.iterator]();!(h=(m=x.next()).done);h=!0){var P=m.value;if(!s[P]){var b=n(P,g++);d+b+2*r>o&&(d=0,p++),s[P]={x:d+r,y:f+p*(i+2*r)+r,width:b,height:i,mask:!0},d+=b+2*r}}}catch(e){v=!0,y=e}finally{try{h||null==x.return||x.return()}finally{if(v)throw y}}var w,_=i+2*r;return{mapping:s,xOffset:d,yOffset:f+p*_,canvasHeight:(w=f+(p+1)*_,Math.pow(2,Math.ceil(Math.log2(w))))}}(Object.assign({getFontWidth:function(e){return p.measureText(e).width},fontHeight:1.2*a,buffer:s,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),g=d.mapping,h=d.canvasHeight,v=d.xOffset,y=d.yOffset;if(f.height!==h){var m=p.getImageData(0,0,f.width,f.height);f.height=h,p.putImageData(m,0,0)}if(Yt(p,r,a,o),l){var x=new kt.a(a,s,c,u,r,o),P=p.getImageData(0,0,x.size,x.size),b=!0,w=!1,_=void 0;try{for(var S,C=t[Symbol.iterator]();!(b=(S=C.next()).done);b=!0){var L=S.value;Jt(x.draw(L),P),p.putImageData(P,g[L].x-s,g[L].y-s)}}catch(e){w=!0,_=e}finally{try{b||null==C.return||C.return()}finally{if(w)throw _}}}else{var O=!0,A=!1,M=void 0;try{for(var E,k=t[Symbol.iterator]();!(O=(E=k.next()).done);O=!0){var z=E.value;p.fillText(z,g[z].x,g[z].y+.9*a)}}catch(e){A=!0,M=e}finally{try{O||null==k.return||k.return()}finally{if(A)throw M}}}return{xOffset:v,yOffset:y,mapping:g,data:f,width:f.width,height:f.height}}},{key:"_getKey",value:function(){var e=this.props,t=e.gl,n=e.fontFamily,i=e.fontWeight,r=e.fontSize,o=e.buffer,a=e.sdf,s=e.radius,l=e.cutoff;return a?"".concat(t," ").concat(n," ").concat(i," ").concat(r," ").concat(o," ").concat(s," ").concat(l):"".concat(t," ").concat(n," ").concat(i," ").concat(r," ").concat(o)}},{key:"texture",get:function(){return this._texture}},{key:"mapping",get:function(){var e=Zt.get(this._key);return e&&e.mapping}},{key:"scale",get:function(){return 1.2}}]),e}(),$t={fontSize:Ut,buffer:Vt,sdf:!1,radius:Bt,cutoff:Ht},Qt={start:1,middle:0,end:-1},en={top:1,center:0,bottom:-1},tn=["fontSize","buffer","sdf","radius","cutoff"],nn={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,backgroundColor:{type:"color",value:null,optional:!0},characterSet:Wt,fontFamily:Nt,fontWeight:Gt,lineHeight:1,fontSettings:{},wordBreak:"word-break",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:function(e){return e.text}},getPosition:{type:"accessor",value:function(e){return e.position}},getColor:{type:"accessor",value:[0,0,0,255]},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]}},rn=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return g()(t,e),a()(t,[{key:"initializeState",value:function(){this.state={fontAtlasManager:new qt(this.context.gl)}}},{key:"updateState",value:function(e){var t=this,n=e.props,i=e.oldProps,r=e.changeFlags,o=this.fontChanged(i,n);o&&this.updateFontAtlas({oldProps:i,props:n});var a=n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth,s=o||a||r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText);if(s&&Array.isArray(r.dataChanged)){var l=this.state.data.slice(),c=r.dataChanged.map((function(e){return mt({data:l,getIndex:function(e){return e.__source.index},dataRange:e,replace:t.transformStringToLetters(e)})}));this.setState({data:l,dataDiff:c})}else s&&this.setState({data:this.transformStringToLetters(),dataDiff:null})}},{key:"finalizeState",value:function(){p()(u()(t.prototype),"finalizeState",this).call(this),this.state.fontAtlasManager.finalize()}},{key:"updateFontAtlas",value:function(e){e.oldProps;var t=e.props,n=t.characterSet,i=t.fontSettings,r=t.fontFamily,o=t.fontWeight,a=this.state.fontAtlasManager;a.setProps(Object.assign({},$t,i,{characterSet:n,fontFamily:r,fontWeight:o}));var s=a.scale,l=a.texture,c=a.mapping;this.setState({scale:s,iconAtlas:l,iconMapping:c}),this.setNeedsRedraw(!0)}},{key:"fontChanged",value:function(e,t){if(e.fontFamily!==t.fontFamily||e.characterSet!==t.characterSet||e.fontWeight!==t.fontWeight)return!0;if(e.fontSettings===t.fontSettings)return!1;var n=e.fontSettings||{},i=t.fontSettings||{};return tn.some((function(e){return n[e]!==i[e]}))}},{key:"getPickingInfo",value:function(e){var t=e.info;return Object.assign(t,{object:t.index>=0?this.props.data[t.index]:null})}},{key:"transformStringToLetters",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.props,i=n.data,r=n.wordBreak,o=n.maxWidth,a=n.lineHeight,s=n.getText,l=this.state.iconMapping,c=t.startRow,u=t.endRow,f=Object(h.createIterable)(i,c,u),p=f.iterable,d=f.objectInfo,g=[],v=!0,y=!1,m=void 0;try{for(var x,P=function(){var t=x.value;d.index++;var n=s(t,d);n&&jt(n,a,r,o,l,(function(n){return e.getSubLayerRow(n,t,d.index)}),g)},b=p[Symbol.iterator]();!(v=(x=b.next()).done);v=!0)P()}catch(e){y=!0,m=e}finally{try{v||null==b.return||b.return()}finally{if(y)throw m}}return g}},{key:"getAnchorXFromTextAnchor",value:function(e){return"function"==typeof e?(e=this.getSubLayerAccessor(e),function(t){return Qt[e(t)]||0}):function(){return Qt[e]||0}}},{key:"getAnchorYFromAlignmentBaseline",value:function(e){return"function"==typeof e?(e=this.getSubLayerAccessor(e),function(t){return Qt[e(t)]||0}):function(){return en[e]||0}}},{key:"renderLayers",value:function(){var e=this.state,t=e.data,n=e.dataDiff,i=e.scale,r=e.iconAtlas,o=e.iconMapping,a=this.props,s=a.backgroundColor,l=a.getPosition,c=a.getColor,u=a.getSize,f=a.getAngle,p=a.getTextAnchor,d=a.getAlignmentBaseline,g=a.getPixelOffset,h=a.billboard,v=a.sdf,y=a.sizeScale,m=a.sizeUnits,x=a.sizeMinPixels,P=a.sizeMaxPixels,b=a.transitions,w=a.updateTriggers;return new(this.getSubLayerClass("characters",Mt))({sdf:v,iconAtlas:r,iconMapping:o,backgroundColor:s,_dataDiff:n&&function(){return n},getPosition:this.getSubLayerAccessor(l),getColor:this.getSubLayerAccessor(c),getSize:this.getSubLayerAccessor(u),getAngle:this.getSubLayerAccessor(f),getAnchorX:this.getAnchorXFromTextAnchor(p),getAnchorY:this.getAnchorYFromAlignmentBaseline(d),getPixelOffset:this.getSubLayerAccessor(g),getPickingIndex:function(e){return e.__source.index},billboard:h,sizeScale:y*i,sizeUnits:m,sizeMinPixels:x*i,sizeMaxPixels:P*i,transitions:b&&{getPosition:b.getPosition,getAngle:b.getAngle,getColor:b.getColor,getSize:b.getSize,getPixelOffset:w.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getPosition:w.getPosition,getAngle:w.getAngle,getColor:w.getColor,getSize:w.getSize,getPixelOffset:w.getPixelOffset,getAnchorX:w.getTextAnchor,getAnchorY:w.getAlignmentBaseline}}),{data:t,getIcon:function(e){return e.text},getRowSize:function(e){return e.rowSize},getOffsets:function(e){return[e.offsetLeft,e.offsetTop]},getParagraphSize:function(e){return e.size}})}}]),t}(h.CompositeLayer);rn.layerName="TextLayer",rn.defaultProps=nn,n.d(t,"ArcLayer",(function(){return x})),n.d(t,"BitmapLayer",(function(){return S})),n.d(t,"IconLayer",(function(){return Oe})),n.d(t,"LineLayer",(function(){return Me})),n.d(t,"PointCloudLayer",(function(){return Ie})),n.d(t,"ScatterplotLayer",(function(){return Re})),n.d(t,"ColumnLayer",(function(){return Ge})),n.d(t,"GridCellLayer",(function(){return Ue})),n.d(t,"PathLayer",(function(){return Xe})),n.d(t,"PolygonLayer",(function(){return Pt})),n.d(t,"GeoJsonLayer",(function(){return Lt})),n.d(t,"TextLayer",(function(){return rn})),n.d(t,"SolidPolygonLayer",(function(){return yt})),n.d(t,"_MultiIconLayer",(function(){return Mt}))}])}));