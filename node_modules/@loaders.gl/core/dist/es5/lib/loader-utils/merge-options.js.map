{"version":3,"sources":["../../../../src/lib/loader-utils/merge-options.js"],"names":["isPureObject","value","constructor","globalOptions","DEFAULT_LOADER_OPTIONS","setGlobalOptions","options","mergeOptions","loader","url","loaderDefaultOptions","defaultOptions","mergedOptions","addUrlOptions","log","NullLog","mergeNestedFields","key","baseUri"],"mappings":";;;;;;;;;;;;;;AAAA;;AACA;;;;;;AAEA,IAAMA,YAAY,GAAG,SAAfA,YAAe,CAAAC,KAAK;AAAA,SACxBA,KAAK,IAAI,yBAAOA,KAAP,MAAiB,QAA1B,IAAsCA,KAAK,CAACC,WAAN,KAAsB,GAAGA,WADvC;AAAA,CAA1B;;AAGA,IAAIC,aAAa,qBAAOC,iCAAP,CAAjB;;AAGO,SAASC,gBAAT,CAA0BC,OAA1B,EAAmC;AACxCH,EAAAA,aAAa,GAAGI,YAAY,CAACJ,aAAD,EAAgBG,OAAhB,CAA5B;AACD;;AAGM,SAASC,YAAT,CAAsBC,MAAtB,EAA8BF,OAA9B,EAAuCG,GAAvC,EAA4C;AACjD,MAAMC,oBAAoB,GACxBF,MAAM,KAAKA,MAAM,CAACJ,sBAAP,IAAiCI,MAAM,CAACG,cAAxC,IAA0DH,MAAM,CAACF,OAAjE,IAA4E,EAAjF,CADR;;AAGA,MAAMM,aAAa,qBAAOF,oBAAP,CAAnB;;AAEAG,EAAAA,aAAa,CAACD,aAAD,EAAgBH,GAAhB,CAAb;;AAGA,MAAIG,aAAa,CAACE,GAAd,KAAsB,IAA1B,EAAgC;AAC9BF,IAAAA,aAAa,CAACE,GAAd,GAAoB,IAAIC,gBAAJ,EAApB;AACD;;AAEDC,EAAAA,iBAAiB,CAACJ,aAAD,EAAgBT,aAAhB,CAAjB;AACAa,EAAAA,iBAAiB,CAACJ,aAAD,EAAgBN,OAAhB,CAAjB;AAEA,SAAOM,aAAP;AACD;;AAGD,SAASI,iBAAT,CAA2BJ,aAA3B,EAA0CN,OAA1C,EAAmD;AACjD,OAAK,IAAMW,GAAX,IAAkBX,OAAlB,EAA2B;AAGzB,QAAIW,GAAG,IAAIX,OAAX,EAAoB;AAClB,UAAML,KAAK,GAAGK,OAAO,CAACW,GAAD,CAArB;;AACA,UAAIjB,YAAY,CAACC,KAAD,CAAZ,IAAuBD,YAAY,CAACY,aAAa,CAACK,GAAD,CAAd,CAAvC,EAA6D;AAC3DL,QAAAA,aAAa,CAACK,GAAD,CAAb,qBACKL,aAAa,CAACK,GAAD,CADlB,MAEKX,OAAO,CAACW,GAAD,CAFZ;AAID,OALD,MAKO;AACLL,QAAAA,aAAa,CAACK,GAAD,CAAb,GAAqBX,OAAO,CAACW,GAAD,CAA5B;AACD;AACF;AAEF;AACF;;AAOD,SAASJ,aAAT,CAAuBP,OAAvB,EAAgCG,GAAhC,EAAqC;AACnC,MAAIA,GAAG,IAAI,EAAE,aAAaH,OAAf,CAAX,EAAoC;AAClCA,IAAAA,OAAO,CAACY,OAAR,GAAkBT,GAAlB;AACD;AACF","sourcesContent":["import {DEFAULT_LOADER_OPTIONS} from '../constants';\nimport {NullLog} from './loggers';\n\nconst isPureObject = value =>\n  value && typeof value === 'object' && value.constructor === {}.constructor;\n\nlet globalOptions = {...DEFAULT_LOADER_OPTIONS};\n\n// Set global loader options\nexport function setGlobalOptions(options) {\n  globalOptions = mergeOptions(globalOptions, options);\n}\n\n// Merges options with global opts and loader defaults, also injects baseUri\nexport function mergeOptions(loader, options, url) {\n  const loaderDefaultOptions =\n    loader && (loader.DEFAULT_LOADER_OPTIONS || loader.defaultOptions || loader.options || {});\n\n  const mergedOptions = {...loaderDefaultOptions};\n\n  addUrlOptions(mergedOptions, url);\n\n  // LOGGING: options.log can be set to `null` to defeat logging\n  if (mergedOptions.log === null) {\n    mergedOptions.log = new NullLog();\n  }\n\n  mergeNestedFields(mergedOptions, globalOptions);\n  mergeNestedFields(mergedOptions, options);\n\n  return mergedOptions;\n}\n\n// Merge nested options objects\nfunction mergeNestedFields(mergedOptions, options) {\n  for (const key in options) {\n    // Check for nested options\n    // object in options => either no key in defaultOptions or object in defaultOptions\n    if (key in options) {\n      const value = options[key];\n      if (isPureObject(value) && isPureObject(mergedOptions[key])) {\n        mergedOptions[key] = {\n          ...mergedOptions[key],\n          ...options[key]\n        };\n      } else {\n        mergedOptions[key] = options[key];\n      }\n    }\n    // else: No need to merge nested opts, and the initial merge already copied over the nested options\n  }\n}\n\n// Harvest information from the url\n// TODO - baseUri should be a directory, i.e. remove file component from baseUri\n// TODO - extract extension?\n// TODO - extract query parameters?\n// TODO - should these be injected on context instead of options?\nfunction addUrlOptions(options, url) {\n  if (url && !('baseUri' in options)) {\n    options.baseUri = url;\n  }\n}\n"],"file":"merge-options.js"}