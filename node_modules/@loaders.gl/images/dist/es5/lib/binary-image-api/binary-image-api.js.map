{"version":3,"sources":["../../../../src/lib/binary-image-api/binary-image-api.js"],"names":["ERR_INVALID_MIME_TYPE","Array","from","mimeTypeMap","keys","join","isBinaryImage","arrayBuffer","mimeType","getBinaryImageTypeHandlers","test","dataView","toDataView","Boolean","getBinaryImageMIMEType","entries","getBinaryImageSize","getSize","size","Error","handlers","get","data","buffer","ArrayBuffer","isView","DataView"],"mappings":";;;;;;;;;;;;;AAQA;;AAEA,IAAMA,qBAAqB,0DAAmDC,KAAK,CAACC,IAAN,CAC5EC,gCAAYC,IAAZ,EAD4E,EAE5EC,IAF4E,CAEvE,IAFuE,CAAnD,CAA3B;;AAKO,SAASC,aAAT,CAAuBC,WAAvB,EAAoCC,QAApC,EAA8C;AACnD,MAAIA,QAAJ,EAAc;AAAA,gCACGC,0BAA0B,CAACD,QAAD,CAD7B;AAAA,QACLE,IADK,yBACLA,IADK;;AAEZ,QAAMC,QAAQ,GAAGC,UAAU,CAACL,WAAD,CAA3B;AACA,WAAOG,IAAI,CAACC,QAAD,CAAX;AACD;;AAED,SAAOE,OAAO,CAACC,sBAAsB,CAACP,WAAD,CAAvB,CAAd;AACD;;AAGM,SAASO,sBAAT,CAAgCP,WAAhC,EAA6C;AAClD,MAAMI,QAAQ,GAAGC,UAAU,CAACL,WAAD,CAA3B;AADkD;AAAA;AAAA;;AAAA;AAIlD,yBAAiCJ,gCAAYY,OAAZ,EAAjC,8HAAwD;AAAA;AAAA,UAA5CP,QAA4C;AAAA,UAAjCE,IAAiC,kBAAjCA,IAAiC;;AACtD,UAAIA,IAAI,CAACC,QAAD,CAAR,EAAoB;AAClB,eAAOH,QAAP;AACD;AACF;AARiD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAUlD,SAAO,IAAP;AACD;;AAEM,SAASQ,kBAAT,CAA4BT,WAA5B,EAA0D;AAAA,MAAjBC,QAAiB,uEAAN,IAAM;AAC/DA,EAAAA,QAAQ,GAAGA,QAAQ,IAAIM,sBAAsB,CAACP,WAAD,CAA7C;;AAD+D,+BAG7CE,0BAA0B,CAACD,QAAD,CAHmB;AAAA,MAGxDS,OAHwD,0BAGxDA,OAHwD;;AAK/D,MAAMN,QAAQ,GAAGC,UAAU,CAACL,WAAD,CAA3B;AACA,MAAMW,IAAI,GAAGD,OAAO,CAACN,QAAD,CAApB;;AAEA,MAAI,CAACO,IAAL,EAAW;AACT,UAAM,IAAIC,KAAJ,wCAA0CX,QAA1C,EAAN;AACD;;AAED,SAAOU,IAAP;AACD;;AAED,SAAST,0BAAT,CAAoCD,QAApC,EAA8C;AAC5C,MAAMY,QAAQ,GAAGjB,gCAAYkB,GAAZ,CAAgBb,QAAhB,CAAjB;;AACA,MAAI,CAACY,QAAL,EAAe;AACb,UAAM,IAAID,KAAJ,CAAUnB,qBAAV,CAAN;AACD;;AACD,SAAOoB,QAAP;AACD;;AAED,SAASR,UAAT,CAAoBU,IAApB,EAA0B;AACxBA,EAAAA,IAAI,GAAGA,IAAI,CAACC,MAAL,IAAeD,IAAtB;;AAOA,MAAIA,IAAI,YAAYE,WAAhB,IAA+BA,WAAW,CAACC,MAAZ,CAAmBH,IAAnB,CAAnC,EAA6D;AAC3D,WAAO,IAAII,QAAJ,CAAaJ,IAAI,CAACC,MAAL,IAAeD,IAA5B,CAAP;AACD;;AAED,QAAM,IAAIH,KAAJ,CAAU,YAAV,CAAN;AACD","sourcesContent":["// Attributions\n// * Based on binary-gltf-utils under MIT license: Copyright (c) 2016-17 Karl Cheng\n\n// TODO: make these functions work for Node.js buffers?\n// Quarantine references to Buffer to prevent bundler from adding big polyfills\n// import {bufferToArrayBuffer} from '../node/buffer-to-array-buffer';\n// TODO - this should be handled in @loaders.gl/polyfills\n\nimport {mimeTypeMap} from './binary-image-parsers';\n\nconst ERR_INVALID_MIME_TYPE = `Invalid MIME type. Supported MIME types are: ${Array.from(\n  mimeTypeMap.keys()\n).join(', ')}`;\n\n// Supported image types are PNG, JPEG, GIF and BMP.\nexport function isBinaryImage(arrayBuffer, mimeType) {\n  if (mimeType) {\n    const {test} = getBinaryImageTypeHandlers(mimeType);\n    const dataView = toDataView(arrayBuffer);\n    return test(dataView);\n  }\n  // check if known type\n  return Boolean(getBinaryImageMIMEType(arrayBuffer));\n}\n\n// Sniffs the contents of a file to attempt to deduce the image type\nexport function getBinaryImageMIMEType(arrayBuffer) {\n  const dataView = toDataView(arrayBuffer);\n\n  // Loop through each file type and see if they work.\n  for (const [mimeType, {test}] of mimeTypeMap.entries()) {\n    if (test(dataView)) {\n      return mimeType;\n    }\n  }\n\n  return null;\n}\n\nexport function getBinaryImageSize(arrayBuffer, mimeType = null) {\n  mimeType = mimeType || getBinaryImageMIMEType(arrayBuffer);\n\n  const {getSize} = getBinaryImageTypeHandlers(mimeType);\n\n  const dataView = toDataView(arrayBuffer);\n  const size = getSize(dataView);\n\n  if (!size) {\n    throw new Error(`invalid image data for type: ${mimeType}`);\n  }\n\n  return size;\n}\n\nfunction getBinaryImageTypeHandlers(mimeType) {\n  const handlers = mimeTypeMap.get(mimeType);\n  if (!handlers) {\n    throw new Error(ERR_INVALID_MIME_TYPE);\n  }\n  return handlers;\n}\n\nfunction toDataView(data) {\n  data = data.buffer || data;\n  // TODO: make these functions work for Node.js buffers?\n  // if (bufferToArrayBuffer) {\n  //   data = bufferToArrayBuffer(data);\n  // }\n\n  // Careful - Node Buffers will look like ArrayBuffers (keep after isBuffer)\n  if (data instanceof ArrayBuffer || ArrayBuffer.isView(data)) {\n    return new DataView(data.buffer || data);\n  }\n\n  throw new Error('toDataView');\n}\n"],"file":"binary-image-api.js"}