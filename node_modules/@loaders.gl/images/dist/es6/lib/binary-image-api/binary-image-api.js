import { mimeTypeMap } from './binary-image-parsers';
const ERR_INVALID_MIME_TYPE = "Invalid MIME type. Supported MIME types are: ".concat(Array.from(mimeTypeMap.keys()).join(', '));
export function isBinaryImage(arrayBuffer, mimeType) {
  if (mimeType) {
    const {
      test
    } = getBinaryImageTypeHandlers(mimeType);
    const dataView = toDataView(arrayBuffer);
    return test(dataView);
  }

  return Boolean(getBinaryImageMIMEType(arrayBuffer));
}
export function getBinaryImageMIMEType(arrayBuffer) {
  const dataView = toDataView(arrayBuffer);

  for (const [mimeType, {
    test
  }] of mimeTypeMap.entries()) {
    if (test(dataView)) {
      return mimeType;
    }
  }

  return null;
}
export function getBinaryImageSize(arrayBuffer, mimeType = null) {
  mimeType = mimeType || getBinaryImageMIMEType(arrayBuffer);
  const {
    getSize
  } = getBinaryImageTypeHandlers(mimeType);
  const dataView = toDataView(arrayBuffer);
  const size = getSize(dataView);

  if (!size) {
    throw new Error("invalid image data for type: ".concat(mimeType));
  }

  return size;
}

function getBinaryImageTypeHandlers(mimeType) {
  const handlers = mimeTypeMap.get(mimeType);

  if (!handlers) {
    throw new Error(ERR_INVALID_MIME_TYPE);
  }

  return handlers;
}

function toDataView(data) {
  data = data.buffer || data;

  if (data instanceof ArrayBuffer || ArrayBuffer.isView(data)) {
    return new DataView(data.buffer || data);
  }

  throw new Error('toDataView');
}
//# sourceMappingURL=binary-image-api.js.map